<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fragrance Playground</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Georgia', serif;
            background: linear-gradient(135deg, #fdfcfb 0%, #e2d1c3 100%);
            min-height: 100vh;
            display: flex;
            overflow: hidden;
        }

        .sidebar {
            width: 280px;
            background: rgba(255, 255, 255, 0.95);
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
            overflow-y: auto;
            transition: margin-left 0.3s ease;
            position: relative;
            z-index: 10;
        }

        .sidebar.collapsed {
            margin-left: -280px;
        }

        .toggle-btn {
            position: absolute;
            right: -40px;
            top: 20px;
            background: rgba(255, 255, 255, 0.95);
            border: none;
            padding: 10px 15px;
            cursor: pointer;
            border-radius: 0 5px 5px 0;
            box-shadow: 2px 2px 5px rgba(0,0,0,0.1);
            font-size: 18px;
        }

        .sidebar-header {
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .sidebar-header h2 {
            font-size: 20px;
            margin-bottom: 5px;
        }

        .sidebar-header p {
            font-size: 12px;
            opacity: 0.9;
        }

        .family {
            border-bottom: 1px solid #eee;
        }

        .family-header {
            padding: 15px 20px;
            background: #f8f8f8;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: bold;
            color: #555;
        }

        .family-header:hover {
            background: #f0f0f0;
        }

        .family-notes {
            padding: 10px;
            display: none;
        }

        .family.open .family-notes {
            display: block;
        }

        .family.open .arrow {
            transform: rotate(90deg);
        }

        .arrow {
            transition: transform 0.3s ease;
        }

        .note {
            background: white;
            padding: 8px 12px;
            margin: 5px;
            border-radius: 20px;
            cursor: move;
            display: inline-block;
            border: 2px solid #ddd;
            font-size: 13px;
            transition: all 0.2s ease;
        }

        .note:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
            border-color: #667eea;
        }

        .note.dragging {
            opacity: 0.5;
        }

        .main-content {
            flex: 1;
            padding: 40px;
            overflow-y: auto;
        }

        .title {
            text-align: center;
            margin-bottom: 40px;
        }

        .title h1 {
            font-size: 36px;
            color: #333;
            margin-bottom: 10px;
        }

        .title p {
            color: #666;
            font-style: italic;
        }

        .pyramid-container {
            max-width: 600px;
            margin: 0 auto 40px;
        }

        .pyramid-level {
            margin: 15px 0;
            text-align: center;
        }

        .level-label {
            font-size: 14px;
            color: #666;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .drop-zone {
            min-height: 80px;
            background: rgba(255, 255, 255, 0.8);
            border: 2px dashed #ccc;
            border-radius: 10px;
            padding: 15px;
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            justify-content: center;
            align-items: center;
            transition: all 0.3s ease;
        }

        .drop-zone.drag-over {
            background: rgba(102, 126, 234, 0.1);
            border-color: #667eea;
            transform: scale(1.02);
        }

        .drop-zone.top {
            width: 50%;
            margin: 0 auto;
        }

        .drop-zone.heart {
            width: 70%;
            margin: 0 auto;
        }

        .drop-zone.base {
            width: 90%;
            margin: 0 auto;
        }

        .placed-note {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 13px;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .remove-btn {
            background: rgba(255, 255, 255, 0.3);
            border: none;
            color: white;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 12px;
            line-height: 1;
        }

        .remove-btn:hover {
            background: rgba(255, 255, 255, 0.5);
        }

        .memory-scene {
            max-width: 700px;
            margin: 0 auto;
            padding: 30px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            min-height: 200px;
        }

        .memory-scene h3 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 22px;
        }

        .memory-scene p {
            color: #555;
            line-height: 1.8;
            font-size: 16px;
        }

        .memory-scene.empty {
            text-align: center;
            color: #999;
        }
    </style>
</head>
<body>
    <div class="sidebar" id="sidebar">
        <button class="toggle-btn" onclick="toggleSidebar()">‚ò∞</button>
        <div class="sidebar-header">
            <h2>Fragrance Notes</h2>
            <p>Drag notes to create your blend</p>
        </div>
        
        <div class="family open">
            <div class="family-header" onclick="toggleFamily(this)">
                <span>üå∏ Floral</span>
                <span class="arrow">‚ñ∂</span>
            </div>
            <div class="family-notes">
                <div class="note" draggable="true" data-note="lavender">Lavender</div>
                <div class="note" draggable="true" data-note="clary sage">Clary Sage</div>
                <div class="note" draggable="true" data-note="geranium">Geranium</div>
                <div class="note" draggable="true" data-note="saffron">Saffron</div>
                <div class="note" draggable="true" data-note="lotus">Lotus</div>
                <div class="note" draggable="true" data-note="lily-of-the-valley">Lily-of-the-Valley</div>
                <div class="note" draggable="true" data-note="marigold">Marigold</div>
                <div class="note" draggable="true" data-note="begonia">Begonia</div>
                <div class="note" draggable="true" data-note="jasmine">Jasmine</div>
                <div class="note" draggable="true" data-note="wild cyclamen">Wild Cyclamen</div>
                <div class="note" draggable="true" data-note="ylang ylang">Ylang Ylang</div>
                <div class="note" draggable="true" data-note="rose">Rose</div>
                <div class="note" draggable="true" data-note="heliotrope">Heliotrope</div>
                <div class="note" draggable="true" data-note="tuberose">Tuberose</div>
                <div class="note" draggable="true" data-note="osmanthus">Osmanthus</div>
                <div class="note" draggable="true" data-note="magnolia">Magnolia</div>
                <div class="note" draggable="true" data-note="immortelle">Immortelle</div>
                <div class="note" draggable="true" data-note="violet">Violet</div>
                <div class="note" draggable="true" data-note="iris">Iris</div>
                <div class="note" draggable="true" data-note="water lily">Water Lily</div>
                <div class="note" draggable="true" data-note="freesia">Freesia</div>
                <div class="note" draggable="true" data-note="vanilla">Vanilla</div>
                <div class="note" draggable="true" data-note="gardenia">Gardenia</div>
                <div class="note" draggable="true" data-note="frangipani">Frangipani</div>
                <div class="note" draggable="true" data-note="honeysuckle">Honeysuckle</div>
                <div class="note" draggable="true" data-note="mimosa">Mimosa</div>
            </div>
        </div>

        <div class="family open">
            <div class="family-header" onclick="toggleFamily(this)">
                <span>üå≤ Woody</span>
                <span class="arrow">‚ñ∂</span>
            </div>
            <div class="family-notes">
                <div class="note" draggable="true" data-note="cedar">Cedar</div>
                <div class="note" draggable="true" data-note="sandalwood">Sandalwood</div>
                <div class="note" draggable="true" data-note="oud">Oud</div>
                <div class="note" draggable="true" data-note="vetiver">Vetiver</div>
                <div class="note" draggable="true" data-note="oak">Oak</div>
                <div class="note" draggable="true" data-note="cypress">Cypress</div>
                <div class="note" draggable="true" data-note="rosewood">Rosewood</div>
                <div class="note" draggable="true" data-note="guaiacwood">Guaiacwood</div>
                <div class="note" draggable="true" data-note="patchouli">Patchouli</div>
                <div class="note" draggable="true" data-note="oakmoss">Oakmoss</div>
                <div class="note" draggable="true" data-note="tree moss">Tree Moss</div>
                <div class="note" draggable="true" data-note="hazelnut">Hazelnut</div>
                <div class="note" draggable="true" data-note="tonka bean">Tonka Bean</div>
            </div>
        </div>

        <div class="family">
            <div class="family-header" onclick="toggleFamily(this)">
                <span>üçä Citrus</span>
                <span class="arrow">‚ñ∂</span>
            </div>
            <div class="family-notes">
                <div class="note" draggable="true" data-note="bergamot">Bergamot</div>
                <div class="note" draggable="true" data-note="bitter orange">Bitter Orange</div>
                <div class="note" draggable="true" data-note="citron">Citron</div>
                <div class="note" draggable="true" data-note="grapefruit">Grapefruit</div>
                <div class="note" draggable="true" data-note="lemon">Lemon</div>
                <div class="note" draggable="true" data-note="lemongrass">Lemongrass</div>
                <div class="note" draggable="true" data-note="mandarin orange">Mandarin Orange</div>
                <div class="note" draggable="true" data-note="pomelo">Pomelo</div>
                <div class="note" draggable="true" data-note="yuzu">Yuzu</div>
                <div class="note" draggable="true" data-note="blood orange">Blood Orange</div>
                <div class="note" draggable="true" data-note="lime">Lime</div>
                <div class="note" draggable="true" data-note="tangerine">Tangerine</div>
            </div>
        </div>

        <div class="family">
            <div class="family-header" onclick="toggleFamily(this)">
                <span>üçé Fruit</span>
                <span class="arrow">‚ñ∂</span>
            </div>
            <div class="family-notes">
                <div class="note" draggable="true" data-note="apple">Apple</div>
                <div class="note" draggable="true" data-note="apricot">Apricot</div>
                <div class="note" draggable="true" data-note="banana">Banana</div>
                <div class="note" draggable="true" data-note="blueberry">Blueberry</div>
                <div class="note" draggable="true" data-note="cherry">Cherry</div>
                <div class="note" draggable="true" data-note="coconut">Coconut</div>
                <div class="note" draggable="true" data-note="peach">Peach</div>
                <div class="note" draggable="true" data-note="plum">Plum</div>
                <div class="note" draggable="true" data-note="fig">Fig</div>
            </div>
        </div>

        <div class="family">
            <div class="family-header" onclick="toggleFamily(this)">
                <span>üåø Greens</span>
                <span class="arrow">‚ñ∂</span>
            </div>
            <div class="family-notes">
                <div class="note" draggable="true" data-note="basil">Basil</div>
                <div class="note" draggable="true" data-note="blackcurrant leaf">Blackcurrant Leaf</div>
                <div class="note" draggable="true" data-note="citron leaf">Citron Leaf</div>
                <div class="note" draggable="true" data-note="oolong">Oolong</div>
                <div class="note" draggable="true" data-note="ginkgo">Ginkgo</div>
                <div class="note" draggable="true" data-note="juniper leaf">Juniper Leaf</div>
                <div class="note" draggable="true" data-note="mint">Mint</div>
                <div class="note" draggable="true" data-note="fig leaf">Fig Leaf</div>
                <div class="note" draggable="true" data-note="violet leaf">Violet Leaf</div>
                <div class="note" draggable="true" data-note="red tea">Red Tea</div>
                <div class="note" draggable="true" data-note="black tea">Black Tea</div>
                <div class="note" draggable="true" data-note="rosemary">Rosemary</div>
                <div class="note" draggable="true" data-note="thyme">Thyme</div>
                <div class="note" draggable="true" data-note="fennel">Fennel</div>
                <div class="note" draggable="true" data-note="sage">Sage</div>
                <div class="note" draggable="true" data-note="anise">Anise</div>
                <div class="note" draggable="true" data-note="forest fern">Forest Fern</div>
            </div>
        </div>

        <div class="family">
            <div class="family-header" onclick="toggleFamily(this)">
                <span>ü¶å Musks</span>
                <span class="arrow">‚ñ∂</span>
            </div>
            <div class="family-notes">
                <div class="note" draggable="true" data-note="amber">Amber</div>
                <div class="note" draggable="true" data-note="ambergris">Ambergris</div>
                <div class="note" draggable="true" data-note="white musk">White Musk</div>
                <div class="note" draggable="true" data-note="musk">Musk</div>
                <div class="note" draggable="true" data-note="beeswax">Beeswax</div>
                <div class="note" draggable="true" data-note="milk">Milk</div>
            </div>
        </div>

        <div class="family">
            <div class="family-header" onclick="toggleFamily(this)">
                <span>üî• Warm</span>
                <span class="arrow">‚ñ∂</span>
            </div>
            <div class="family-notes">
                <div class="note" draggable="true" data-note="honey">Honey</div>
                <div class="note" draggable="true" data-note="tobacco">Tobacco</div>
                <div class="note" draggable="true" data-note="incense">Incense</div>
                <div class="note" draggable="true" data-note="frankincense">Frankincense</div>
                <div class="note" draggable="true" data-note="cinnamon">Cinnamon</div>
                <div class="note" draggable="true" data-note="pepper">Pepper</div>
                <div class="note" draggable="true" data-note="ginger">Ginger</div>
                <div class="note" draggable="true" data-note="coriander">Coriander</div>
                <div class="note" draggable="true" data-note="tamarind">Tamarind</div>
            </div>
        </div>

        <div class="family">
            <div class="family-header" onclick="toggleFamily(this)">
                <span>‚ö° Synthetic</span>
                <span class="arrow">‚ñ∂</span>
            </div>
            <div class="family-notes">
                <div class="note" draggable="true" data-note="ambroxan">Ambroxan</div>
                <div class="note" draggable="true" data-note="ozonic note">Ozonic Note</div>
                <div class="note" draggable="true" data-note="airy note">Airy Note</div>
                <div class="note" draggable="true" data-note="marine note">Marine Note</div>
                <div class="note" draggable="true" data-note="salty note">Salty Note</div>
                <div class="note" draggable="true" data-note="ink">Ink</div>
                <div class="note" draggable="true" data-note="leather note">Leather Note</div>
                <div class="note" draggable="true" data-note="suede note">Suede Note</div>
            </div>
        </div>
    </div>

    <div class="main-content">
        <div class="title">
            <h1>Fragrance Playground</h1>
            <p>Create your perfect scent memory by blending notes</p>
        </div>

        <div class="pyramid-container">
            <div class="pyramid-level">
                <div class="level-label">Top Notes</div>
                <div class="drop-zone top" data-level="top"></div>
            </div>

            <div class="pyramid-level">
                <div class="level-label">Heart Notes</div>
                <div class="drop-zone heart" data-level="heart"></div>
            </div>

            <div class="pyramid-level">
                <div class="level-label">Base Notes</div>
                <div class="drop-zone base" data-level="base"></div>
            </div>
        </div>

        <div class="memory-scene empty" id="memoryScene">
            <p>Start adding notes to discover your memory scene...</p>
        </div>
    </div>

    <script>
        const composition = {
            top: [],
            heart: [],
            base: []
        };

        document.querySelectorAll('.note').forEach(note => {
            note.addEventListener('dragstart', (e) => {
                e.dataTransfer.setData('text/plain', e.target.dataset.note);
                e.target.classList.add('dragging');
            });

            note.addEventListener('dragend', (e) => {
                e.target.classList.remove('dragging');
            });
        });

        document.querySelectorAll('.drop-zone').forEach(zone => {
            zone.addEventListener('dragover', (e) => {
                e.preventDefault();
                zone.classList.add('drag-over');
            });

            zone.addEventListener('dragleave', () => {
                zone.classList.remove('drag-over');
            });

            zone.addEventListener('drop', (e) => {
                e.preventDefault();
                zone.classList.remove('drag-over');
                
                const noteName = e.dataTransfer.getData('text/plain');
                const level = zone.dataset.level;
                
                addNoteToLevel(noteName, level, zone);
                updateMemoryScene();
            });
        });

        function addNoteToLevel(noteName, level, zone) {
            if (composition[level].includes(noteName)) return;
            
            composition[level].push(noteName);
            
            const placedNote = document.createElement('div');
            placedNote.className = 'placed-note';
            placedNote.innerHTML = `
                ${noteName}
                <button class="remove-btn" onclick="removeNote('${noteName}', '${level}')">√ó</button>
            `;
            
            zone.appendChild(placedNote);
        }

        function removeNote(noteName, level) {
            composition[level] = composition[level].filter(n => n !== noteName);
            updateDropZone(level);
            updateMemoryScene();
        }

        function updateDropZone(level) {
            const zone = document.querySelector(`.drop-zone.${level}`);
            zone.innerHTML = '';
            composition[level].forEach(noteName => {
                const placedNote = document.createElement('div');
                placedNote.className = 'placed-note';
                placedNote.innerHTML = `
                    ${noteName}
                    <button class="remove-btn" onclick="removeNote('${noteName}', '${level}')">√ó</button>
                `;
                zone.appendChild(placedNote);
            });
        }

        function updateMemoryScene() {
            const scene = document.getElementById('memoryScene');
            const allNotes = [...composition.top, ...composition.heart, ...composition.base];
            
            if (allNotes.length === 0) {
                scene.className = 'memory-scene empty';
                scene.innerHTML = '<p>Start adding notes to discover your memory scene...</p>';
                return;
            }

            scene.className = 'memory-scene';
            const memory = generateMemoryScene(allNotes, composition);
            scene.innerHTML = `
                <h3>${memory.title}</h3>
                <p>${memory.description}</p>
            `;
        }

        function generateMemoryScene(allNotes, comp) {
            const has = (...notes) => notes.some(n => allNotes.includes(n));
            const hasAny = (noteArray) => noteArray.some(n => allNotes.includes(n));
            const count = (noteArray) => noteArray.filter(n => allNotes.includes(n)).length;
            
            const florals = ['lavender', 'clary sage', 'geranium', 'saffron', 'lotus', 'lily-of-the-valley', 'marigold', 'begonia', 'jasmine', 'wild cyclamen', 'ylang ylang', 'rose', 'heliotrope', 'tuberose', 'osmanthus', 'magnolia', 'immortelle', 'violet', 'iris', 'water lily', 'freesia', 'vanilla', 'gardenia', 'frangipani', 'honeysuckle', 'mimosa'];
            const woody = ['cedar', 'sandalwood', 'oud', 'vetiver', 'oak', 'cypress', 'rosewood', 'guaiacwood', 'patchouli', 'oakmoss', 'tree moss', 'hazelnut', 'tonka bean'];
            const citrus = ['bergamot', 'bitter orange', 'citron', 'grapefruit', 'lemon', 'lemongrass', 'mandarin orange', 'pomelo', 'yuzu', 'blood orange', 'lime', 'tangerine'];
            const fruits = ['apple', 'apricot', 'banana', 'blueberry', 'cherry', 'coconut', 'peach', 'plum', 'fig'];
            const greens = ['basil', 'blackcurrant leaf', 'citron leaf', 'oolong', 'ginkgo', 'juniper leaf', 'mint', 'fig leaf', 'violet leaf', 'red tea', 'black tea', 'rosemary', 'thyme', 'fennel', 'sage', 'anise', 'forest fern'];
            const musks = ['amber', 'ambergris', 'white musk', 'musk', 'beeswax', 'milk'];
            const warm = ['honey', 'tobacco', 'incense', 'frankincense', 'cinnamon', 'pepper', 'ginger', 'coriander', 'tamarind'];
            const synthetic = ['ambroxan', 'ozonic note', 'airy note', 'marine note', 'salty note', 'ink', 'leather note', 'suede note'];
            
            const hasFloral = hasAny(florals);
            const hasWoody = hasAny(woody);
            const hasCitrus = hasAny(citrus);
            const hasFruit = hasAny(fruits);
            const hasGreen = hasAny(greens);
            const hasMusk = hasAny(musks);
            const hasWarm = hasAny(warm);
            const hasSynthetic = hasAny(synthetic);
            
            // SPECIFIC NOTE COMBINATIONS (most specific first)
            
            // New note-specific scenes
            if (has('rose', 'oud') && hasMusk) {
                return {
                    title: "Silk Road Caravan",
                    description: "Velvet pouches spill precious oud chips beside dried rose petals from Damascus. Merchants haggle in languages that blend like the scents themselves. This is luxury measured in grams, beauty that survives thousand-mile journeys across desert and mountain."
                };
            }
            
            if (has('iris', 'violet') && hasWoody) {
                return {
                    title: "Parisian Powder Room",
                    description: "Carved wooden vanities hold crystal bottles from another century. Powdered iris and violet sachets perfume silk-lined drawers where pearl necklaces rest. The air tastes of elegance refined through generations, of beauty as architecture."
                };
            }
            
            if (has('tuberose', 'ylang ylang') && has('vanilla')) {
                return {
                    title: "Bali Temple Evening",
                    description: "White flowers illuminate dusk like earthbound stars, their narcotic perfume thickening as day fades. Vanilla-scented offerings steam at shrine bases while ylang ylang petals scatter in tropical winds. Paradise exists, but only in moments like these."
                };
            }
            
            if (has('osmanthus', 'peach') && hasGreen) {
                return {
                    title: "Chinese Autumn Garden",
                    description: "Osmanthus blooms scatter like sweet snow over paths lined with peach trees past their fruit-bearing prime. Tea cools in porcelain cups as the afternoon stretches golden and eternal. This is beauty tinged with impermanence, sweetness shadowed by farewell."
                };
            }
            
            if (has('magnolia', 'citron') && hasMusk) {
                return {
                    title: "Southern Estate Morning",
                    description: "Magnolias bloom impossibly large against white columns while citron trees perfume the breakfast terrace. Everything moves slowly here‚Äîconversation, time, the drift of perfume through humid air. Grace isn't rushed; it's cultivated like the gardens themselves."
                };
            }
            
            if (has('fig', 'fig leaf') && hasWoody) {
                return {
                    title: "Mediterranean Courtyard Siesta",
                    description: "Fig trees drop heavy fruit into shadows cast by weathered stone. The leaves release their milky green scent in the afternoon heat while wooden shutters keep rooms cool and dark. Time suspends between sleep and waking, sweetness and shade."
                };
            }
            
            if (has('patchouli', 'rose') && has('vanilla')) {
                return {
                    title: "Bohemian Apartment, 1970s",
                    description: "Vintage velvet cushions scatter across wooden floors where incense burns beside wilting roses. Patchouli oil stains silk scarves as vinyl records spin. This is beauty unpolished, romance unstructured, an aesthetic of authentic imperfection."
                };
            }
            
            if (has('tonka bean', 'vanilla', 'honey')) {
                return {
                    title: "Patisserie Kitchen at Dawn",
                    description: "Bakers fold warm tonka into custards as vanilla pods steep in cream. Honey drizzles golden over yesterday's work while ovens promise today's magic. The air is so sweet it almost aches, so rich you could get drunk on breathing."
                };
            }
            
            if (has('yuzu', 'ginger') && hasGreen) {
                return {
                    title: "Japanese Bathhouse",
                    description: "Yuzu fruits float in steaming water as ginger tea cools on cypress benches. The air is thick with vapor and healing‚Äîevery breath cleanses, every moment restores. Here, bathing isn't hygiene but ceremony, self-care elevated to art."
                };
            }
            
            if (has('black tea', 'bergamot') && hasMusk) {
                return {
                    title: "English Library, Teatime",
                    description: "Earl Grey steeps in bone china as rain streaks library windows. Leather chairs cradle bodies weary from reading while bergamot perfumes the pause between chapters. Civilization distills to this: warmth, words, the ritual of afternoon tea."
                };
            }
            
            if (has('leather note', 'tobacco') && hasWoody) {
                return {
                    title: "Gentleman's Club Smoking Room",
                    description: "Leather armchairs hold the shape of decades of contemplation. Pipe tobacco curls toward coffered oak ceilings as brandy catches firelight. This room knows secrets kept, deals struck, the weight of words spoken among equals."
                };
            }
            
            if (has('ink', 'violet leaf') && hasWoody) {
                return {
                    title: "Writer's Desk at Midnight",
                    description: "Fountain pens leak ink onto manuscript pages as violets wilt in a water glass. Wooden desk drawers hold rejection letters and hope in equal measure. Creation happens here in the small hours, messy and private and utterly necessary."
                };
            }
            
            if (has('suede note', 'iris') && hasMusk) {
                return {
                    title: "Luxury Boutique Dressing Room",
                    description: "Suede gloves rest on velvet cushions as iris-scented candles flicker in mirrors multiplied to infinity. Every texture whispers quality, every surface suggests taste. Shopping here isn't transaction but transformation, fantasy briefly made flesh."
                };
            }
            
            if (has('mimosa', 'honey', 'beeswax')) {
                return {
                    title: "Apiary in Spring",
                    description: "Mimosa blossoms dust everything gold as bees work their ancient alchemy. Wax cells fill with honey that tastes of sunshine and time. The air hums with purpose, sweet with industry, alive with the compact between flower and insect."
                };
            }
            
            if (has('heliotrope', 'vanilla', 'almond')) {
                return {
                    title: "Grandmother's Kitchen",
                    description: "Heliotrope from the garden scents the windowsill as almond cookies cool beside vanilla pudding. Everything here speaks of care made tangible, love expressed through sugar and butter. Memory lives in scent more than any photograph could capture."
                };
            }
            
            if (has('frangipani', 'coconut') && hasMusk) {
                return {
                    title: "Polynesian Moonlight",
                    description: "Frangipani leis drape on palm bark as coconut husks smolder in fire pits. The ocean breathes against white sand while stars pierce the darkness like scattered seeds. Paradise isn't a place but a feeling, and it smells like this."
                };
            }
            
            if (has('immortelle', 'curry') || has('immortelle', 'tamarind')) {
                return {
                    title: "Moroccan Spice Market",
                    description: "Immortelle flowers pile beside curry spice pyramids under striped awnings. The air is a riot of gold and amber, sweet and savory colliding in unexpected harmony. Every breath is an adventure, every scent a story waiting to be told."
                };
            }
            
            if (has('water lily', 'lotus') && hasSynthetic) {
                return {
                    title: "Minimalist Spa Sanctuary",
                    description: "Lotus and water lilies float in infinity pools where architecture disappears into water, water into sky. The scent is barely there, more suggestion than statement, perfection pursued through subtraction. Luxury whispers; it never shouts."
                };
            }
            
            if (has('gardenia', 'tuberose') && hasMusk) {
                return {
                    title: "Tropical Wedding Night",
                    description: "Gardenia and tuberose crown the bride as candles gutter in humid darkness. The air is so thick with flowers it's almost indecent, beauty bordering on excess. Love announced this loudly can't help but succeed‚Äîor spectacularly fail."
                };
            }
            
            if (has('honeysuckle', 'peach') && hasGreen) {
                return {
                    title: "Southern Summer Porch",
                    description: "Honeysuckle vines tangle on porch railings as peach preserves simmer in the kitchen. The afternoon is liquid gold, time moving like honey, conversation flowing like sweet tea. Nothing urgent exists here, only the gentle insistence of now."
                };
            }
            
            if (has('rosewood', 'rose') && hasWarm) {
                return {
                    title: "Sacred Rose Garden",
                    description: "Rosewood prayer beads click softly as dawn illuminates rose bushes planted by devotees. Incense trails between petals and pews, the sacred and beautiful inseparable. Worship here happens through beauty, faith expressed in cultivation."
                };
            }
            
            if (has('guaiacwood', 'pepper') && hasGreen) {
                return {
                    title: "Argentine Asado Smoke",
                    description: "Guaiacwood smolders under meat as pepper cracks over chimichurri. The smoke is sweet, spicy, primal‚Äîa scent that speaks to something ancient in human memory. Cooking like this isn't just feeding; it's communion."
                };
            }
            
            if (has('oakmoss', 'tree moss') && hasFloral) {
                return {
                    title: "Enchanted Forest Clearing",
                    description: "Moss carpets everything‚Äîstones, fallen logs, the bases of trees so old they seem mythic. Wildflowers break through green in unexpected bursts of color. Fairy tales start in places like this, where nature feels intentional, almost conscious."
                };
            }
            
            if (has('hazelnut', 'tonka bean', 'vanilla')) {
                return {
                    title: "Chocolate Shop Window",
                    description: "Hazelnut pralines pile beside tonka-infused truffles as vanilla ganache sets on marble slabs. Everything here is almost too beautiful to eat, luxury measured in cocoa percentages and careful craftsmanship. Temptation made visible, touchable, impossible to resist."
                };
            }
            
            if (has('pomelo', 'grapefruit') && hasGreen) {
                return {
                    title: "Vietnamese Morning Market",
                    description: "Vendors slice pomelo and grapefruit into flower shapes as mint and basil bundle beside them. The air vibrates with freshness‚Äîsharp, green, impossibly alive. Markets like this don't sell ingredients; they sell optimism, each dawn a new chance."
                };
            }
            
            if (has('blood orange', 'cinnamon') && hasWoody) {
                return {
                    title: "Winter Spiced Drink",
                    description: "Blood orange wheels float in mulled wine as cinnamon sticks sink toward the bottom. Wood crackles in the fireplace while snow piles against windows. Warmth tastes like this‚Äîsharp fruit softened by spice, cold held at bay by careful preparation."
                };
            }
            
            if (has('lime', 'mint', 'coriander')) {
                return {
                    title: "Mexican Street Food Stand",
                    description: "Lime juice sprays over everything as cilantro and mint pile beside tacos. The air is bright, herbal, hungry-making‚Äîscents that promise satisfaction before the first bite. Street food at its best is alchemy: simple ingredients transformed through skill and love."
                };
            }
            
            if (has('tangerine', 'clove') || has('tangerine', 'cinnamon')) {
                return {
                    title: "Christmas Market Twilight",
                    description: "Tangerines stud clove-studded oranges hanging in wooden stalls. Cinnamon swirls through cold air as lights begin twinkling against early darkness. Holidays smell like this‚Äîanticipation mixed with tradition, sweetness spiced with nostalgia."
                };
            }
            
            if (has('plum', 'cinnamon') && hasWoody) {
                return {
                    title: "Autumn Preserving Kitchen",
                    description: "Plums simmer with cinnamon sticks as jars sterilize on wood counters. The kitchen windows fog with steam that carries summer into winter, fruit transformed into patience. This is time made edible, seasons captured in glass."
                };
            }
            
            if (has('apricot', 'honey', 'beeswax')) {
                return {
                    title: "Orchard Beekeeper's Cottage",
                    description: "Apricot trees shade hives humming with industry. Honey extracted this morning still holds the warmth of beeswax and sunlight. Everything here exists in symbiosis‚Äîtrees feed bees, bees pollinate trees, humans harvest carefully, gratefully."
                };
            }
            
            if (has('cherry', 'almond') || has('cherry', 'tonka bean')) {
                return {
                    title: "Viennese Coffeehouse Afternoon",
                    description: "Cherry strudel cools beside almond tortes as coffee machines hiss baroque patterns. Newspapers rustle at marble tables where time moves differently‚Äîslower, thicker, richer. Caf√©s like this aren't businesses; they're institutions, temples to the art of lingering."
                };
            }
            
            if (has('banana', 'coconut', 'vanilla')) {
                return {
                    title: "Tropical Smoothie Bar",
                    description: "Blenders whir banana and coconut into sweet oblivion as vanilla extract sweetens already-sweet fruit. The air is vacation in liquid form, sunshine made drinkable. Health food rarely tastes this much like dessert, guilt-free indulgence served cold."
                };
            }
            
            if (has('blueberry', 'lemon') && hasGreen) {
                return {
                    title: "Summer Farm Breakfast",
                    description: "Fresh blueberries tumble into lemon-drizzled pancakes as mint tea steeps. Morning light makes everything golden‚Äîthe table, the fields beyond, the possibilities of a whole day stretching ahead. Mornings like this feel like gifts unwrapped slowly."
                };
            }
            
            if (has('violet leaf', 'cucumber') || (has('violet leaf') && hasSynthetic)) {
                return {
                    title: "Modern Skincare Laboratory",
                    description: "Green extracts suspend in clear gel as scientists measure violet leaf molecules. Everything here is controlled, intentional, designed for effect. Beauty science pursues nature not to copy but to distill, to isolate the essential from the merely present."
                };
            }
            
            if (has('red tea', 'honey') && hasCitrus) {
                return {
                    title: "Cape Town Sunset Tea",
                    description: "Rooibos steeps amber-red as honey dissolves into warmth and citrus peels curl beside the cup. Mountains silhouette against orange sky while the Atlantic whispers. This brew tastes of earth and sun, a continent distilled into comfort."
                };
            }
            
            if (has('rosemary', 'lemon') && hasWoody) {
                return {
                    title: "Tuscan Hillside Villa",
                    description: "Rosemary hedges line lemon groves climbing toward a stone farmhouse. The air is so clean it shimmers, herbs and fruit mingling with cypress and distance. Beauty here isn't decoration; it's the landscape's native language."
                };
            }
            
            if (has('thyme', 'honey') && hasWoody) {
                return {
                    title: "Greek Island Taverna",
                    description: "Thyme honey drips onto yogurt as wooden tables creak under the weight of simple abundance. Olive trees shade whitewashed walls while the sea glitters beyond. Food this simple shouldn't taste this complex, but terroir works its magic."
                };
            }
            
            if (has('fennel', 'anise') && hasCitrus) {
                return {
                    title: "Mediterranean Fish Market",
                    description: "Fennel and anise season the day's catch as lemon halves wait on cutting boards. Everything smells of the sea and the herbs that grow beside it. Cooking here honors both elements‚Äîwater's gifts prepared with land's blessings."
                };
            }
            
            if (has('sage', 'tobacco') && hasWoody) {
                return {
                    title: "Desert Sunset Ceremony",
                    description: "Sage smoke spirals skyward as tobacco offerings burn beside juniper wood. The desert air is thin, clear, holy‚Äîevery scent travels far, every prayer seems heard. Ritual here isn't performance; it's conversation with the infinite."
                };
            }
            
            if (has('forest fern', 'oakmoss', 'vetiver')) {
                return {
                    title: "Pacific Northwest Trail",
                    description: "Ferns unfurl beside moss-covered logs as vetiver roots anchor steep slopes. The air tastes green, damp, ancient‚Äîforests so old they feel like cathedrals. Walking here isn't exercise; it's pilgrimage to where the wild things still rule."
                };
            }
            
            if (has('milk', 'vanilla', 'honey')) {
                return {
                    title: "Childhood Bedtime Ritual",
                    description: "Warm milk sweetens with honey and vanilla as a parent's voice reads stories into the darkness. Safety smells like this‚Äîsimple, sweet, utterly reliable. Every adult carries this scent memory, a touchstone to innocence and being unconditionally loved."
                };
            }
            
            if (has('beeswax', 'frankincense', 'myrrh')) {
                return {
                    title: "Byzantine Cathedral",
                    description: "Beeswax candles illuminate icons painted in gold leaf as frankincense censers swing through ancient liturgy. The air is so thick with centuries of prayer it almost glows. Faith accumulates here like sediment, layer upon believing layer."
                };
            }
            
            if (has('pepper', 'ginger', 'coriander')) {
                return {
                    title: "Indian Spice Bazaar",
                    description: "Vendors grind pepper, ginger, and coriander in mortar and pestle, clouds of spice making eyes water and mouths anticipate. This isn't cooking; it's chemistry, magic practiced daily, flavor as alchemy. India tastes like this‚Äîcomplex, vibrant, impossible to simplify."
                };
            }
            
            if (has('tamarind', 'cinnamon') && hasCitrus) {
                return {
                    title: "Thai Night Market",
                    description: "Tamarind paste sweetens pad thai as cinnamon scents iced tea beside lime wedges. Neon reflects in puddles while vendors shout in languages that taste like their food‚Äîlayered, surprising, perfectly balanced. Street food here is haute cuisine that hasn't forgotten its roots."
                };
            }
            
            if (has('ambroxan', 'iris') && hasWoody) {
                return {
                    title: "Luxury Department Store Perfume Floor",
                    description: "Ambroxan amplifies iris into something almost supernatural as sales associates spray testers on cardstock. Everything here is aspirational‚Äîscents that promise transformation, beauty as purchase, identity in crystal bottles. You don't just smell these perfumes; you imagine who you'd become wearing them."
                };
            }
            
            // Previous combinations continue...
            if (has('marine note', 'salty note') && hasCitrus) {
                return {
                    title: "Cliffside at Dawn",
                    description: "Salt spray mists your face as waves crash against ancient rocks below. The first rays of sun illuminate citrus groves climbing the hillside, their bright scent carried on ocean winds. You stand at the edge of land and sea, breathing in the raw power of nature's meeting point."
                };
            }
            
            if (has('ozonic note') && hasCitrus && hasGreen) {
                return {
                    title: "After the Storm",
                    description: "Rain-washed air sparkles with electricity as storm clouds retreat over distant hills. Crushed leaves and bright citrus mingle in puddles reflecting clearing skies. Everything feels impossibly clean, renewed, alive with possibility."
                };
            }
            
            if (has('jasmine', 'saffron') && hasMusk) {
                return {
                    title: "Persian Palace Garden",
                    description: "Night falls on a marble courtyard where jasmine vines climb ancient walls. Saffron-stained carpets flutter in archways as servants light oil lamps. The air is thick with luxury, sensuality, and the weight of empires."
                };
            }
            
            if (has('lavender') && hasWoody && hasCitrus) {
                return {
                    title: "Provence Farmhouse",
                    description: "Purple fields stretch toward cedar-shuttered windows where lemon cakes cool on stone sills. Cicadas drone in the afternoon heat as lavender waves in the mistral wind. This is summer distilled to its essence‚Äîwarm, languid, perfect."
                };
            }
            
            // BROADER CATEGORY COMBINATIONS
            
            if (hasCitrus && hasFruit && hasFloral && count(florals) >= 2) {
                return {
                    title: "Garden Party in Full Bloom",
                    description: "Flower arrangements tower beside fruit platters as citrus drinks sparkle in crystal. Guests in summer whites drift through gardens where every sense celebrates abundance. This is joy made visible, beauty as generous as the hosts."
                };
            }
            
            if (hasWoody && hasGreen && hasCitrus && !hasFloral) {
                return {
                    title: "Morning Forest Hike",
                    description: "Sunlight filters through cedar boughs as you crush pine needles underfoot. The air is sharp with resin, herbs, and the bright promise of citrus groves in the valley below. Every breath clears the mind, grounds the spirit, reconnects you to earth."
                };
            }
            
            if (hasFloral && hasMusk && hasWarm && count(florals) >= 3) {
                return {
                    title: "Perfumer's Masterpiece",
                    description: "Flowers bloom across base notes of musk and warmth, a composition decades in the making. Each sniff reveals new layers‚Äîthis isn't fragrance but architecture, scent as storytelling. Wearing this means carrying a small work of art everywhere you go."
                };
            }
            
            if (hasFruit && hasWarm && hasWoody && !hasCitrus) {
                return {
                    title: "Autumn Harvest Feast",
                    description: "Roasted fruits glaze under spiced honey as wooden tables groan with abundance. Smoke from the hearth mingles with cinnamon and clove. This is gratitude made tangible, community gathered around plenty, the season's final gift before winter's arrival."
                };
            }
            
            if (hasGreen && hasCitrus && hasSynthetic && !hasFloral) {
                return {
                    title: "Rooftop Garden, Modern City",
                    description: "Herb boxes and citrus trees thrive impossible stories above street level. The air is green and fresh despite urban surroundings, nature reclaimed through human ingenuity. This is hope planted in concrete, beauty insisting on its place even in steel and glass."
                };
            }
            
            if (hasSynthetic && hasFloral && hasMusk && count(florals) >= 2) {
                return {
                    title: "Avant-Garde Perfume Launch",
                    description: "Models glide through installations where flowers are projected onto walls and scent is pumped through vents. This isn't perfume; it's experience design, fragrance as concept art. Beauty here is engineered, calculated, and somehow still manages to move you."
                };
            }
            
            if (hasWarm && hasFruit && hasCitrus) {
                return {
                    title: "Moroccan Riad Breakfast",
                    description: "Spiced fruit compote steams beside fresh citrus as honey drizzles over everything. Sunlight filters through pierced screens, painting geometric patterns on tiled floors. Mornings here are unhurried rituals where every sense is honored, every moment savored."
                };
            }
            
            if (hasWoody && hasMusk && hasWarm && !hasFloral && !hasCitrus) {
                return {
                    title: "Private Library After Dark",
                    description: "Leather-bound volumes line oak shelves as amber lamps cast pools of warmth. The air is thick with age, knowledge, and the musk of time itself. This room rewards those who linger, revealing its secrets only to patient souls."
                };
            }
            
            if (hasFruit && hasGreen && hasFloral && hasCitrus) {
                return {
                    title: "Botanical Garden Conservatory",
                    description: "Fruit trees and flowers coexist in climate-controlled paradise as herbs carpet the pathways. The air is layered‚Äîcitrus brightness over green earthiness over floral sweetness. This is the world in miniature, ecosystems from every continent gathered under glass."
                };
            }
            
            // SINGLE FAMILY DOMINANT SCENES (more specific)
            
            if (count(florals) >= 5) {
                return {
                    title: "Royal Wedding Bouquet",
                    description: "Dozens of flower species cascade in careful arrangement, each chosen for meaning as much as beauty. The scent is almost overwhelming‚Äîa symphony where every instrument insists on being heard. This is florals unrestrained, beauty bordering on excess, love announced without subtlety."
                };
            }
            
            if (count(woody) >= 4) {
                return {
                    title: "Ancient Forest Temple",
                    description: "Trees older than memory shelter wooden structures weathered to silver. The air is meditation itself‚Äîgrounding, centering, eternal. Walk here and you'll understand why humans have always sought the divine among trees."
                };
            }
            
            if (count(citrus) >= 4) {
                return {
                    title: "Amalfi Coast Drive",
                    description: "Lemon groves cling to cliffs as the road curves impossibly above azure water. Every variety of citrus grows here, their fruits bright as jewels against green leaves. The air tastes of vacation, freedom, the Mediterranean in its most generous mood."
                };
            }
            
            if (count(greens) >= 4) {
                return {
                    title: "Herb Garden After Rain",
                    description: "Every variety of green releases its oils as raindrops trigger aromatic explosions. The air is almost edible‚Äîsavory, fresh, alive with chlorophyll and possibility. Gardens like this feed body and soul, sustenance measured in more than calories."
                };
            }
            
            if (count(warm) >= 3) {
                return {
                    title: "Spice Trader's Warehouse",
                    description: "Burlap sacks split at the seams, spilling cinnamon bark and dried peppers across wooden floors. The air burns pleasantly, warmth that awakens rather than soothes. Fortunes are made here, adventures begin here, every journey starts with spice."
                };
            }
            
            // FAMILY PAIR COMBINATIONS (more variations)
            
            if (hasFloral && hasWoody && count(florals) >= 2 && count(woody) >= 2) {
                return {
                    title: "Botanical Artist's Studio",
                    description: "Pressed flowers arrange beside wood samples as reference for paintings half-finished. The studio smells of creation‚Äînatural materials transformed through art, beauty studied and celebrated. Every surface tells a story of observation becoming interpretation."
                };
            }
            
            if (hasCitrus && hasWoody && !hasFloral && !hasFruit) {
                return {
                    title: "Carpentry Workshop, Lemon Grove",
                    description: "Wood shavings curl beside open windows where lemon trees perfume the breeze. The scent marriage is unexpected but perfect‚Äîcitrus brightness cutting through sawdust richness. Craft happens here, honest work that smells of earth and effort."
                };
            }
            
            if (hasFruit && hasMusk && !hasFloral && !hasCitrus) {
                return {
                    title: "Vintner's Private Cellar",
                    description: "Fruit ferments in oak barrels acquiring depth and complexity. The air is sweet, funky, alive with transformation. Wine isn't made here; it's midwifed, natural processes guided by knowledge earned across generations."
                };
            }
            
            if (hasGreen && hasWarm && !hasFloral) {
                return {
                    title: "Apothecary's Workbench",
                    description: "Herbs dry in bundles as spices grind into healing preparations. The air speaks of remedy, of nature's pharmacy carefully catalogued. Medicine here isn't just chemistry; it's tradition, wisdom, the earth's gifts skillfully applied."
                };
            }
            
            if (hasSynthetic && hasCitrus && !hasFloral && !hasFruit) {
                return {
                    title: "Science Lab Meets Nature",
                    description: "Beakers hold citrus extracts being analyzed molecule by molecule. The scent is both natural and artificial, truth and interpretation existing side by side. Research here chases understanding, breaking beauty down to build it back better."
                };
            }
            
            if (hasMusk && hasFloral && count(florals) === 1) {
                return {
                    title: "Vintage Perfume Discovery",
                    description: "A single flower note blooms from a base of aged musk, simple but profound. This is perfumery's essence‚Äîtwo elements becoming more than their sum. Sometimes the most powerful statements are the quietest ones."
                };
            }
            
            // TRIPLE FAMILY COMBINATIONS (additional)
            
            if (hasWoody && hasGreen && hasWarm) {
                return {
                    title: "Mountain Monastery Kitchen",
                    description: "Herbs from the garden season simple meals cooked over wood fires. Spices from trade routes add warmth to ascetic fare. Self-sufficiency smells like this‚Äîgrounded, grateful, surprisingly rich in its simplicity."
                };
            }
            
            if (hasCitrus && hasFruit && hasGreen) {
                return {
                    title: "Farmers Market Peak Season",
                    description: "Fruit stands neighbor herb bundles as citrus pyramids catch morning sun. Everything here was picked this dawn, still holding dew and possibility. Markets like this are community made visible, the land's abundance shared."
                };
            }
            
            if (hasFloral && hasFruit && hasMusk) {
                return {
                    title: "Haute Couture Fashion Show",
                    description: "Models trail flower and fruit scents as fabric whispers past. Musk grounds the sweetness, adding skin and sensuality. This is luxury as theater, beauty as performance, fashion that engages every sense."
                };
            }
            
            // COMPREHENSIVE FALLBACKS (by family)
            
            if (hasFloral && allNotes.length >= 3) {
                return {
                    title: "Secret Garden Path",
                    description: "Flowers bloom in unexpected corners where gardeners rarely reach. The air is perfumed chaos, beauty unplanned, nature's own arrangements always surpassing human design. Walking here feels like discovering something meant just for you."
                };
            }
            
            if (hasWoody && allNotes.length >= 2) {
                return {
                    title: "Woodworker's Morning",
                    description: "Different woods release distinct songs as saws and planes transform them. The air is meditation and muscle memory, craft practiced until it becomes prayer. Creating with wood connects us to forests, to trees, to time itself."
                };
            }
            
            if (hasCitrus && allNotes.length >= 2) {
                return {
                    title: "Citrus Sunrise Ritual",
                    description: "You slice into bright fruit as morning light floods the kitchen. Juice runs sticky-sweet, the day's first taste sharp and promising. Mornings that start like this seem destined for good things."
                };
            }
            
            if (hasFruit) {
                return {
                    title: "Summer's Peak Moment",
                    description: "Fruit ripens to perfect sweetness, that single day between under-ripe and over. The air is heavy with the season's generosity, with nature's timing, with flavors you'll spend winter remembering. Abundance like this is brief but total."
                };
            }
            
            if (hasGreen) {
                return {
                    title: "First Day of Spring",
                    description: "Green pushes through brown as plants remember their purpose. The air tastes of chlorophyll and promise, winter's grip finally broken. Everything growing seems to do so audibly, the earth exhaling relief and renewal."
                };
            }
            
            if (hasMusk) {
                return {
                    title: "Skin Scent Memory",
                    description: "This smells like someone‚Äîwarm skin, individual chemistry, the way bodies carry scent. It's intimate without being intrusive, personal without being private. We all have this smell; few of us really know it."
                };
            }
            
            if (hasWarm) {
                return {
                    title: "Comfort in Cold",
                    description: "Warmth becomes tangible‚Äînot just temperature but feeling, not just heat but haven. The air promises safety, offers solace, wraps around you like the arms of someone who loves you. Winter is defeated here, one spice at a time."
                };
            }
            
            if (hasSynthetic) {
                return {
                    title: "Tomorrow's Scent Today",
                    description: "This smells like nothing nature ever made, and that's precisely the point. It's the future announcing itself, technology serving beauty, humans extending nature's palette. Not imitation but innovation, not copy but creation."
                };
            }
            
            // ULTIMATE FALLBACK
            const noteList = allNotes.slice(0, 5).join(', ');
            const extras = allNotes.length > 5 ? ` and ${allNotes.length - 5} more` : '';
            
            return {
                title: "Your Unique Olfactory Journey",
                description: `This blend of ${noteList}${extras} creates something entirely new‚Äîa scent landscape that exists only in your imagination and nowhere else on earth. Like the best memories, it defies simple description, living instead as feeling, as atmosphere, as a private world you've built from nature's infinite vocabulary.`
            };
        }

        function toggleSidebar() {
            document.getElementById('sidebar').classList.toggle('collapsed');
        }

        function toggleFamily(header) {
            header.parentElement.classList.toggle('open');
        }
    </script>
</body>
</html>
