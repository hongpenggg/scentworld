<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ScentWorld - Fragrance Memory Painter</title>
    
    <!-- Tailwind CSS (via CDN for immediate deployment) -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,600;0,700;1,400&family=Lato:wght@300;400;700&display=swap" rel="stylesheet">

    <style>
        /* --- Core Variables --- */
        :root {
            --glass-bg: rgba(255, 255, 255, 0.65);
            --glass-border: rgba(255, 255, 255, 0.4);
            --glass-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.1);
            --blur: 16px;
            --gold: #D4AF37;
            --text-main: #2c2c2c;
        }

        /* --- Base Settings --- */
        body {
            font-family: 'Lato', sans-serif;
            background: linear-gradient(135deg, #fdfbfb 0%, #ebedee 100%);
            overflow: hidden; /* App-like feel */
            color: var(--text-main);
            -webkit-tap-highlight-color: transparent;
        }

        .serif { font-family: 'Playfair Display', serif; }

        /* --- Shapes & Glassmorphism --- */
        .squircle {
            border-radius: 24px;
        }

        .glass {
            background: var(--glass-bg);
            backdrop-filter: blur(var(--blur));
            -webkit-backdrop-filter: blur(var(--blur));
            border: 1px solid var(--glass-border);
            box-shadow: var(--glass-shadow);
        }

        /* --- Floating Sidebar Animations --- */
        #sidebar-container {
            transition: transform 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
            z-index: 50;
        }
        
        #sidebar-container.closed {
            transform: translateX(-120%);
        }

        /* When closed, we show a separate restore button, handled in JS/DOM */

        /* --- Accordion Transitions --- */
        .family-content {
            max-height: 0;
            opacity: 0;
            overflow: hidden;
            transition: max-height 0.4s cubic-bezier(0.4, 0, 0.2, 1), opacity 0.3s ease;
        }
        
        .family-header.active + .family-content {
            max-height: 500px;
            opacity: 1;
        }

        /* --- Header Parallelogram Links --- */
        .nav-link {
            position: relative;
            text-decoration: none;
            color: #333;
            padding: 2px 8px;
            display: inline-block;
            transition: color 0.3s ease;
        }

        .nav-link::before {
            content: '';
            position: absolute;
            bottom: 0;
            left: -4px;
            width: calc(100% + 8px);
            height: 40%; /* Half highlight initially */
            background: rgba(212, 175, 55, 0.25);
            transform: skewX(-20deg);
            z-index: -1;
            transition: height 0.3s cubic-bezier(0.4, 0, 0.2, 1), background 0.3s ease;
        }

        .nav-link:hover::before {
            height: 100%; /* Full expand */
            background: rgba(212, 175, 55, 0.4);
        }

        /* --- Interaction Mode --- */
        #main-stage {
            transition: filter 0.4s ease;
        }

        .selection-active #main-stage {
            filter: blur(5px) grayscale(20%);
        }

        .layer-highlight {
            animation: pulse-gold 2s infinite;
            background: rgba(255, 255, 255, 0.5);
            border: 2px solid rgba(212, 175, 55, 0.6);
            z-index: 60;
        }

        @keyframes pulse-gold {
            0% { box-shadow: 0 0 0 0 rgba(212, 175, 55, 0.4); }
            70% { box-shadow: 0 0 0 15px rgba(212, 175, 55, 0); }
            100% { box-shadow: 0 0 0 0 rgba(212, 175, 55, 0); }
        }

        /* --- Custom Scrollbar --- */
        .custom-scroll::-webkit-scrollbar { width: 4px; }
        .custom-scroll::-webkit-scrollbar-track { background: transparent; }
        .custom-scroll::-webkit-scrollbar-thumb { background: rgba(0,0,0,0.15); border-radius: 10px; }

        /* --- Animations --- */
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fade-in { animation: fadeIn 0.4s ease-out forwards; }

        /* Floating Shadow Helpers */
        .hover-shadow-soft:hover {
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>
<body class="h-screen w-screen relative">

    <!-- 
      AUDIO: 
      Path set to "assets/piano.mp3".
      Ensure the file structure is correct.
      'loop' attribute ensures infinite playback.
    -->
    <audio id="bg-music" loop>
        <source src="assets/piano.mp3" type="audio/mpeg">
        <source src="assets/piano.mp3" type="audio/mp3">
        <!-- Fallback message -->
    </audio>

    <!-- 
      START OVERLAY: 
      Required to bypass browser Autoplay Policy.
      The music will start the moment the user interacts with this screen.
    -->
    <div id="start-screen" class="fixed inset-0 z-[100] bg-[#fdfbfb] flex flex-col items-center justify-center transition-opacity duration-700 cursor-pointer">
        <div class="text-center animate-fade-in">
            <h1 class="text-5xl md:text-7xl font-serif text-gray-800 italic mb-4">ScentWorld</h1>
            <p class="text-gray-500 font-light tracking-widest uppercase text-xs md:text-sm">Tap to Enter</p>
        </div>
    </div>

    <!-- SELECTION OVERLAY: Background dimming when a note is selected -->
    <div id="selection-overlay" class="fixed inset-0 bg-white/60 backdrop-blur-sm z-40 hidden opacity-0 transition-opacity duration-300">
        <div class="absolute top-24 left-0 w-full text-center pointer-events-none">
            <p class="text-2xl font-serif text-gray-800">Where does <span id="selected-note-display" class="italic font-bold text-[#D4AF37]"></span> belong?</p>
            <p class="text-sm text-gray-500 mt-2 uppercase tracking-wider">Select a layer on the pyramid</p>
        </div>
    </div>

    <!-- HEADER -->
    <header class="fixed top-0 left-0 w-full px-6 py-6 md:px-10 z-30 flex justify-between items-start pointer-events-none">
        <!-- Logo -->
        <div class="pointer-events-auto">
            <h1 class="text-2xl font-serif font-bold text-gray-800 tracking-wide">ScentWorld</h1>
        </div>
        <!-- Nav -->
        <nav class="pointer-events-auto flex gap-6 md:gap-10">
            <a href="index.html" class="nav-link text-xs md:text-sm font-bold uppercase tracking-widest">Home</a>
            <a href="gemini.html" class="nav-link text-xs md:text-sm font-bold uppercase tracking-widest">ScentWorld AI</a>
        </nav>
    </header>

    <!-- FLOATING SIDEBAR CONTAINER -->
    <div id="sidebar-container" class="fixed top-24 bottom-24 left-4 md:left-8 w-72 z-50 flex flex-col pointer-events-auto">
        
        <!-- The Sidebar Itself -->
        <aside class="glass squircle w-full h-full flex flex-col relative overflow-visible">
            
            <!-- Toggle Button (Attached to top-right, floating outside) -->
            <button id="sidebar-toggle" class="absolute -right-14 top-0 w-10 h-10 md:w-12 md:h-12 glass squircle flex items-center justify-center text-gray-600 transition-all duration-300 hover:text-gray-900 hover-shadow-soft group" title="Minimize/Maximize">
                <svg id="toggle-icon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
            </button>

            <!-- Sidebar Header -->
            <div class="p-6 border-b border-white/40">
                <h2 class="font-serif text-lg italic text-gray-700">Olfactory Notes</h2>
            </div>

            <!-- Notes List -->
            <div id="notes-list" class="flex-1 overflow-y-auto custom-scroll p-4 space-y-3">
                <!-- Javascript will inject families here -->
            </div>
        </aside>
    </div>

    <!-- RESTORE BUTTON (Appears when sidebar is closed) -->
    <button id="sidebar-restore" class="fixed top-24 left-4 md:left-8 w-12 h-12 glass squircle z-40 flex items-center justify-center text-gray-600 shadow-md hover:shadow-xl transition-all duration-300 transform -translate-x-full opacity-0">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
            <line x1="9" y1="3" x2="9" y2="21"></line>
        </svg>
    </button>

    <!-- MAIN STAGE (Pyramid & Output) -->
    <main id="main-stage" class="fixed inset-0 flex flex-col items-center justify-center z-10 pointer-events-auto">
        <div class="w-full max-w-5xl flex flex-col md:flex-row items-center justify-center gap-8 md:gap-16 p-4">
            
            <!-- Pyramid -->
            <div class="relative w-[320px] h-[320px] md:w-[420px] md:h-[420px] shrink-0">
                <!-- Decorative BG Triangle -->
                <svg class="absolute inset-0 w-full h-full text-gray-300/50" viewBox="0 0 100 100" preserveAspectRatio="none">
                    <polygon points="50,5 95,95 5,95" fill="none" stroke="currentColor" stroke-width="0.5" stroke-dasharray="4 4"/>
                </svg>

                <!-- Layer: Top -->
                <div id="layer-top" class="absolute w-full h-[30%] top-0 left-0 z-20 flex flex-col items-center justify-end pb-2 cursor-pointer transition-all duration-300 group"
                     onclick="handleLayerClick('top')">
                     <!-- Clip Path Shape -->
                    <div class="absolute inset-0 bg-white/30 backdrop-blur-sm border-b border-white/50 transition-colors group-hover:bg-white/50" 
                         style="clip-path: polygon(50% 0%, 100% 100%, 0% 100%);"></div>
                    <span class="relative z-30 text-[10px] font-bold uppercase tracking-widest text-gray-500 mb-1 pointer-events-none">Top</span>
                    <div id="content-top" class="relative z-30 flex flex-wrap justify-center gap-1 px-8 min-h-[20px]"></div>
                </div>

                <!-- Layer: Middle -->
                <div id="layer-middle" class="absolute w-full h-[30%] top-[30%] left-0 z-20 flex flex-col items-center justify-center cursor-pointer transition-all duration-300 group"
                     onclick="handleLayerClick('middle')">
                    <div class="absolute inset-0 bg-white/40 backdrop-blur-sm border-b border-white/50 transition-colors group-hover:bg-white/60"
                         style="clip-path: polygon(20% 0%, 80% 0%, 100% 100%, 0% 100%);"></div>
                    <span class="relative z-30 text-[10px] font-bold uppercase tracking-widest text-gray-500 mb-1 pointer-events-none">Heart</span>
                    <div id="content-middle" class="relative z-30 flex flex-wrap justify-center gap-1 px-12 min-h-[20px]"></div>
                </div>

                <!-- Layer: Base -->
                <div id="layer-base" class="absolute w-full h-[40%] top-[60%] left-0 z-20 flex flex-col items-center justify-start pt-4 cursor-pointer transition-all duration-300 group"
                     onclick="handleLayerClick('base')">
                    <div class="absolute inset-0 bg-white/50 backdrop-blur-sm transition-colors group-hover:bg-white/70"
                         style="clip-path: polygon(14% 0%, 86% 0%, 100% 100%, 0% 100%);"></div>
                    <span class="relative z-30 text-[10px] font-bold uppercase tracking-widest text-gray-500 mb-1 pointer-events-none">Base</span>
                    <div id="content-base" class="relative z-30 flex flex-wrap justify-center gap-1 px-16 min-h-[20px]"></div>
                </div>
            </div>

            <!-- Memory Output -->
            <div class="w-full md:w-96 glass squircle p-8 min-h-[280px] flex flex-col justify-center relative transition-all duration-500">
                <div id="memory-content" class="transition-opacity duration-500">
                    <h3 class="text-2xl font-serif text-gray-800 mb-4 italic" id="mem-title">The Scent of Blank Canvas</h3>
                    <p class="text-gray-600 font-light leading-relaxed" id="mem-desc">
                        Add notes to the pyramid to awaken a memory. The top notes introduce the moment, the heart notes tell the story, and the base notes linger like a feeling you can't shake.
                    </p>
                </div>
            </div>

        </div>
    </main>

    <!-- MUSIC CONTROLS (Bottom Center on Mobile, Bottom Right on Desktop? User said specific circle with note) -->
    <!-- Placing floating at bottom right for better mobile ergonomics, or centered if preferred. Let's do fixed bottom center as per typical mobile UX, adjusted for desktop -->
    <div class="fixed bottom-24 left-1/2 transform -translate-x-1/2 z-50 pointer-events-none">
        <button id="music-toggle" class="pointer-events-auto w-14 h-14 rounded-full glass flex items-center justify-center text-gray-700 shadow-lg hover:shadow-2xl transition-all duration-300 group hover:scale-105" title="Toggle Music">
            <!-- Icon injected by JS -->
            <span id="music-icon-wrapper"></span>
        </button>
    </div>

    <!-- FOOTER -->
    <footer class="fixed bottom-0 left-0 w-full p-4 md:p-6 z-30 pointer-events-none bg-gradient-to-t from-white/80 to-transparent">
        <div class="pointer-events-auto max-w-7xl mx-auto flex flex-col items-start">
            <span class="font-serif font-bold text-gray-800 text-lg">ScentWorld</span>
            <p class="text-xs text-gray-600 mt-1">&copy; Hongpeng Wei, 2025.</p>
            <p class="text-[10px] text-gray-400 mt-0.5">The music on this site is JANACEK Sonata 1.X.1905, copyright of Charlie Albright, Free Music Archive.</p>
        </div>
    </footer>

    <!-- LOGIC -->
    <script>
        // --- Configuration & Data ---
        const fragranceData = [
            {
                family: "Citrus",
                colorClass: "bg-yellow-200 border-yellow-300 text-yellow-900",
                hoverClass: "hover:bg-yellow-300",
                notes: ["Bergamot", "Lemon", "Grapefruit", "Mandarin", "Lime", "Yuzu"]
            },
            {
                family: "Floral",
                colorClass: "bg-pink-200 border-pink-300 text-pink-900",
                hoverClass: "hover:bg-pink-300",
                notes: ["Rose", "Jasmine", "Lavender", "Peony", "Tuberose", "Gardenia"]
            },
            {
                family: "Woody",
                colorClass: "bg-stone-300 border-stone-400 text-stone-900",
                hoverClass: "hover:bg-stone-400",
                notes: ["Sandalwood", "Cedar", "Vetiver", "Oud", "Patchouli", "Pine"]
            },
            {
                family: "Oriental",
                colorClass: "bg-orange-200 border-orange-300 text-orange-900",
                hoverClass: "hover:bg-orange-300",
                notes: ["Vanilla", "Amber", "Musk", "Cinnamon", "Cardamom", "Myrrh"]
            },
            {
                family: "Fresh",
                colorClass: "bg-cyan-200 border-cyan-300 text-cyan-900",
                hoverClass: "hover:bg-cyan-300",
                notes: ["Sea Salt", "Rain", "Cucumber", "Green Tea", "Mint", "Sage"]
            }
        ];

        // --- State Management ---
        const state = {
            pyramid: { top: [], middle: [], base: [] },
            selectedNote: null, // { name: string, colorClass: string }
            isMusicPlaying: true, // We assume "Playing" state for the button, but audio needs trigger
            sidebarOpen: true
        };

        // --- DOM Elements ---
        const dom = {
            audio: document.getElementById('bg-music'),
            startScreen: document.getElementById('start-screen'),
            sidebarContainer: document.getElementById('sidebar-container'),
            sidebarToggle: document.getElementById('sidebar-toggle'),
            sidebarRestore: document.getElementById('sidebar-restore'),
            notesList: document.getElementById('notes-list'),
            selectionOverlay: document.getElementById('selection-overlay'),
            selectedNoteDisplay: document.getElementById('selected-note-display'),
            musicToggle: document.getElementById('music-toggle'),
            musicIconWrapper: document.getElementById('music-icon-wrapper'),
            layers: {
                top: document.getElementById('layer-top'),
                middle: document.getElementById('layer-middle'),
                base: document.getElementById('layer-base')
            },
            contents: {
                top: document.getElementById('content-top'),
                middle: document.getElementById('content-middle'),
                base: document.getElementById('content-base')
            },
            memTitle: document.getElementById('mem-title'),
            memDesc: document.getElementById('mem-desc'),
            memContainer: document.getElementById('memory-content')
        };

        // --- Initialization ---
        function init() {
            renderSidebar();
            renderMusicIcon();
            
            // Audio Autoplay Hack
            dom.startScreen.addEventListener('click', () => {
                dom.startScreen.style.opacity = '0';
                setTimeout(() => dom.startScreen.remove(), 700);
                
                // Attempt Play
                dom.audio.volume = 0.5;
                dom.audio.play().then(() => {
                    state.isMusicPlaying = true;
                    renderMusicIcon();
                }).catch(err => {
                    console.log("Audio requires explicit button press later.");
                    state.isMusicPlaying = false;
                    renderMusicIcon();
                });
            });

            // Music Toggle
            dom.musicToggle.addEventListener('click', () => {
                if (state.isMusicPlaying) {
                    dom.audio.pause();
                    state.isMusicPlaying = false;
                } else {
                    dom.audio.play();
                    state.isMusicPlaying = true;
                }
                renderMusicIcon();
            });

            // Sidebar Toggle
            dom.sidebarToggle.addEventListener('click', toggleSidebar);
            dom.sidebarRestore.addEventListener('click', toggleSidebar);

            // Overlay Cancel
            dom.selectionOverlay.addEventListener('click', cancelSelection);
        }

        // --- Sidebar Logic ---
        function renderSidebar() {
            dom.notesList.innerHTML = '';
            
            fragranceData.forEach(family => {
                const wrapper = document.createElement('div');
                wrapper.className = "mb-3 rounded-xl overflow-hidden transition-all duration-300";

                // Header
                const header = document.createElement('button');
                // Closed state: Slightly more opaque than glass. 
                // We use bg-opacity-80 combined with the color class.
                header.className = `family-header w-full text-left px-5 py-3 flex justify-between items-center text-xs font-bold uppercase tracking-widest transition-all ${family.colorClass.replace('bg-', 'bg-opacity-90 bg-')} hover:brightness-95`;
                header.innerHTML = `
                    <span>${family.family}</span>
                    <svg class="w-4 h-4 transform transition-transform duration-300" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                `;

                // Content
                const content = document.createElement('div');
                content.className = "family-content bg-white/40";
                
                const grid = document.createElement('div');
                grid.className = "p-3 flex flex-wrap gap-2";

                family.notes.forEach(noteName => {
                    const pill = document.createElement('span');
                    pill.className = `cursor-pointer select-none px-3 py-1.5 rounded-full text-xs font-semibold shadow-sm border transition-all duration-200 transform hover:-translate-y-1 hover:shadow-md ${family.colorClass} ${family.hoverClass}`;
                    pill.innerText = noteName;
                    
                    // Interaction Trigger
                    pill.addEventListener('click', (e) => {
                        e.stopPropagation(); // Stop accordion from toggling
                        initiateSelection(noteName, family.colorClass);
                    });

                    grid.appendChild(pill);
                });

                content.appendChild(grid);
                wrapper.appendChild(header);
                wrapper.appendChild(content);

                // Accordion Click
                header.addEventListener('click', () => {
                    // Close others
                    document.querySelectorAll('.family-header').forEach(h => {
                        if (h !== header) {
                            h.classList.remove('active');
                            h.querySelector('svg').style.transform = 'rotate(0deg)';
                        }
                    });
                    
                    // Toggle current
                    header.classList.toggle('active');
                    const icon = header.querySelector('svg');
                    icon.style.transform = header.classList.contains('active') ? 'rotate(180deg)' : 'rotate(0deg)';
                });

                dom.notesList.appendChild(wrapper);
            });
        }

        function toggleSidebar() {
            state.sidebarOpen = !state.sidebarOpen;
            
            if (state.sidebarOpen) {
                // Open
                dom.sidebarContainer.classList.remove('closed');
                dom.sidebarRestore.classList.remove('translate-x-0', 'opacity-100');
                dom.sidebarRestore.classList.add('-translate-x-full', 'opacity-0');
            } else {
                // Close
                dom.sidebarContainer.classList.add('closed');
                // Show restore button after delay
                setTimeout(() => {
                    dom.sidebarRestore.classList.remove('-translate-x-full', 'opacity-0');
                    dom.sidebarRestore.classList.add('translate-x-0', 'opacity-100');
                }, 300);
            }
        }

        // --- Selection & Pyramid Logic ---
        function initiateSelection(name, colorClass) {
            state.selectedNote = { name, colorClass };
            
            // Visuals
            dom.selectionOverlay.classList.remove('hidden');
            // Force reflow
            void dom.selectionOverlay.offsetWidth;
            dom.selectionOverlay.classList.remove('opacity-0');
            
            document.body.classList.add('selection-active');
            dom.selectedNoteDisplay.innerText = name;

            // Highlight layers (High Z-Index)
            Object.values(dom.layers).forEach(el => el.classList.add('layer-highlight'));
        }

        function cancelSelection() {
            state.selectedNote = null;
            
            dom.selectionOverlay.classList.add('opacity-0');
            document.body.classList.remove('selection-active');
            
            Object.values(dom.layers).forEach(el => el.classList.remove('layer-highlight'));

            setTimeout(() => {
                dom.selectionOverlay.classList.add('hidden');
            }, 300);
        }

        function handleLayerClick(layerId) {
            if (!state.selectedNote) return;

            // Add Data
            state.pyramid[layerId].push(state.selectedNote);

            // Add DOM Element
            const chip = document.createElement('span');
            chip.className = `animate-fade-in inline-block px-2 py-0.5 m-0.5 rounded-full text-[10px] md:text-xs font-bold border cursor-pointer hover:bg-red-100 hover:text-red-900 hover:border-red-200 transition-colors ${state.selectedNote.colorClass}`;
            chip.innerText = state.selectedNote.name;
            chip.title = "Remove Note";
            
            // Remove Logic
            const noteRef = state.selectedNote; // closure capture
            chip.addEventListener('click', (e) => {
                e.stopPropagation();
                removeNote(layerId, noteRef, chip);
            });

            dom.contents[layerId].appendChild(chip);

            // Finish
            updateMemory();
            cancelSelection();
        }

        function removeNote(layerId, noteObj, domEl) {
            // Remove Data
            const idx = state.pyramid[layerId].indexOf(noteObj);
            if (idx > -1) state.pyramid[layerId].splice(idx, 1);
            
            // Remove DOM
            domEl.remove();
            updateMemory();
        }

        // --- Memory Engine ---
        function updateMemory() {
            const p = state.pyramid;
            const top = p.top.map(n => n.name);
            const mid = p.middle.map(n => n.name);
            const base = p.base.map(n => n.name);
            const all = [...top, ...mid, ...base];

            // Fade Text
            dom.memContainer.style.opacity = '0';

            setTimeout(() => {
                const text = generatePoetry(top, mid, base, all);
                dom.memTitle.innerText = text.title;
                dom.memDesc.innerText = text.desc;
                dom.memContainer.style.opacity = '1';
            }, 500);
        }

        function generatePoetry(top, mid, base, all) {
            if (all.length === 0) {
                return {
                    title: "The Scent of Blank Canvas",
                    desc: "Add notes to the pyramid to awaken a memory. The top notes introduce the moment, the heart notes tell the story, and the base notes linger like a feeling you can't shake."
                };
            }

            // Checks
            const has = (n) => all.includes(n);
            
            // 1. Rose + Oud (Classic)
            if (has("Rose") && has("Oud")) {
                return {
                    title: "Midnight at the Palace",
                    desc: "Ancient walls cooling in the desert night. The heavy, resinous smoke of Oud wraps around the tender, velvet petals of Rose. A secret kept for a thousand years, silken robes, and the promise of eternity."
                };
            }

            // 2. Sea Salt + Wood (Beach)
            if (has("Sea Salt") && (has("Cedar") || has("Sandalwood"))) {
                return {
                    title: "Driftwood & Tides",
                    desc: "Bleached wood drying on hot sand. The salt crusts on your skin as the sun dips below the horizon. The air is crisp, carrying the ghosts of distant lands across the water."
                };
            }

            // 3. Citrus + Fresh (Summer)
            if (top.length >= 2 && mid.length === 0 && base.length === 0) {
                return {
                    title: "First Light",
                    desc: "A burst of pure, blinding sunlight through linen curtains. It is sharp, effervescent, and full of impossible optimism. The day hasn't made any mistakes yet."
                };
            }

            // 4. Vanilla + Amber (Cozy)
            if (has("Vanilla") && has("Amber")) {
                return {
                    title: "Cashmere Embrace",
                    desc: "A golden glow in a dim room. Sweet warmth radiates from the skin, comforting and slow. It feels like being held, like safety, like home."
                };
            }

             // 5. Green Tea + Jasmine
             if (has("Green Tea") && has("Jasmine")) {
                return {
                    title: "Kyoto Morning",
                    desc: "Steam rising from a ceramic cup. The garden is wet with dew, and small white flowers tremble in the breeze. Clarity, silence, and perfect balance."
                };
            }

            // Fallback Construction
            const intro = top.length ? `It opens with a spark of ${top[0]}, ` : "It begins quietly, ";
            const heart = mid.length ? `blooming into a heart of ${mid.join(' and ')}. ` : "moving through empty space. ";
            const outro = base.length ? `Finally, it settles into ${base.join(' and ')}, lingering like a memory.` : "It fades before it can take hold.";

            return {
                title: "A Custom Composition",
                desc: intro + heart + outro
            };
        }

        // --- Music Icon Logic ---
        function renderMusicIcon() {
            // USER REQUEST:
            // "Default state is music playing, button with music note and line across (off button)"
            // "If music off, button will change to... off button but without the line across"
            
            const iconSize = 24;
            
            if (state.isMusicPlaying) {
                // ICON: Music Note with Line (Meaning "Turn Off")
                dom.musicIconWrapper.innerHTML = `
                    <svg xmlns="http://www.w3.org/2000/svg" width="${iconSize}" height="${iconSize}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M9 18V5l12-2v13"></path>
                        <circle cx="6" cy="18" r="3"></circle>
                        <circle cx="18" cy="16" r="3"></circle>
                        <line x1="2" y1="2" x2="22" y2="22"></line>
                    </svg>
                `;
            } else {
                // ICON: Music Note (Meaning "Turn On")
                dom.musicIconWrapper.innerHTML = `
                    <svg xmlns="http://www.w3.org/2000/svg" width="${iconSize}" height="${iconSize}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M9 18V5l12-2v13"></path>
                        <circle cx="6" cy="18" r="3"></circle>
                        <circle cx="18" cy="16" r="3"></circle>
                    </svg>
                `;
            }
        }

        // Run
        init();

    </script>
</body>
</html>