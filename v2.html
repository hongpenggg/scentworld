<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ScentWorld - Fragrance Memory Painter</title>
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,600;0,700;1,400&family=Lato:wght@300;400;700&display=swap" rel="stylesheet">

    <style>
        /* --- CSS Reset & Tailwind Utilities --- */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html { font-size: 16px; }
        body { line-height: 1.5; }

        /* Tailwind-like utility classes */
        .w-full { width: 100%; }
        .h-full { height: 100%; }
        .min-h-screen { min-height: 100vh; }
        .flex { display: flex; }
        .flex-col { flex-direction: column; }
        .items-center { align-items: center; }
        .justify-center { justify-content: center; }
        .justify-between { justify-content: space-between; }
        .justify-start { justify-content: flex-start; }
        .justify-end { justify-content: flex-end; }
        .gap-1 { gap: 0.25rem; }
        .gap-2 { gap: 0.5rem; }
        .gap-4 { gap: 1rem; }
        .gap-6 { gap: 1.5rem; }
        .gap-8 { gap: 2rem; }
        .gap-12 { gap: 3rem; }
        .p-4 { padding: 1rem; }
        .p-6 { padding: 1.5rem; }
        .p-10 { padding: 2.5rem; }
        .px-3 { padding-left: 0.75rem; padding-right: 0.75rem; }
        .px-5 { padding-left: 1.25rem; padding-right: 1.25rem; }
        .px-8 { padding-left: 2rem; padding-right: 2rem; }
        .px-10 { padding-left: 2.5rem; padding-right: 2.5rem; }
        .px-14 { padding-left: 3.5rem; padding-right: 3.5rem; }
        .px-20 { padding-left: 5rem; padding-right: 5rem; }
        .py-1 { padding-top: 0.25rem; padding-bottom: 0.25rem; }
        .py-4 { padding-top: 1rem; padding-bottom: 1rem; }
        .py-6 { padding-top: 1.5rem; padding-bottom: 1.5rem; }
        .pb-2 { padding-bottom: 0.5rem; }
        .pb-8 { padding-bottom: 2rem; }
        .pb-12 { padding-bottom: 3rem; }
        .pt-6 { padding-top: 1.5rem; }
        .pt-24 { padding-top: 6rem; }
        .pl-0 { padding-left: 0; }
        .pl-96 { padding-left: 24rem; }
        .pr-4 { padding-right: 1rem; }
        .pr-12 { padding-right: 3rem; }
        .m-0 { margin: 0; }
        .mb-1 { margin-bottom: 0.25rem; }
        .mb-4 { margin-bottom: 1rem; }
        .mb-6 { margin-bottom: 1.5rem; }
        .mt-1 { margin-top: 0.25rem; }
        .mt-2 { margin-top: 0.5rem; }
        .mt-16 { margin-top: 4rem; }
        .inline-block { display: inline-block; }
        .absolute { position: absolute; }
        .fixed { position: fixed; }
        .relative { position: relative; }
        .inset-0 { top: 0; right: 0; bottom: 0; left: 0; }
        .top-0 { top: 0; }
        .top-32 { top: 8rem; }
        .bottom-0 { bottom: 0; }
        .bottom-8 { bottom: 2rem; }
        .bottom-12 { bottom: 3rem; }
        .left-0 { left: 0; }
        .left-6 { left: 1.5rem; }
        .right-8 { right: 2rem; }
        .top-24 { top: 6rem; }
        .top-[30%] { top: 30%; }
        .top-[60%] { top: 60%; }
        .z-20 { z-index: 20; }
        .z-30 { z-index: 30; }
        .z-40 { z-index: 40; }
        .z-50 { z-index: 50; }
        .z-60 { z-index: 60; }
        .z-100 { z-index: 100; }
        .rounded-full { border-radius: 9999px; }
        .rounded-2xl { border-radius: 1rem; }
        .text-center { text-align: center; }
        .text-left { text-align: left; }
        .text-xs { font-size: 0.75rem; }
        .text-sm { font-size: 0.875rem; }
        .text-base { font-size: 1rem; }
        .text-lg { font-size: 1.125rem; }
        .text-xl { font-size: 1.25rem; }
        .text-2xl { font-size: 1.5rem; }
        .text-3xl { font-size: 1.875rem; }
        .text-6xl { font-size: 3.75rem; }
        .text-8xl { font-size: 5rem; }
        .font-light { font-weight: 300; }
        .font-bold { font-weight: 700; }
        .font-semibold { font-weight: 600; }
        .uppercase { text-transform: uppercase; }
        .italic { font-style: italic; }
        .tracking-[0.2em] { letter-spacing: 0.2em; }
        .tracking-[0.3em] { letter-spacing: 0.3em; }
        .tracking-widest { letter-spacing: 0.1em; }
        .tracking-wide { letter-spacing: 0.025em; }
        .leading-relaxed { line-height: 1.625; }
        .text-gray-400 { color: #9ca3af; }
        .text-gray-500 { color: #6b7280; }
        .text-gray-600 { color: #4b5563; }
        .text-gray-700 { color: #374151; }
        .text-gray-800 { color: #1f2937; }
        .text-gray-900 { color: #111827; }
        .text-white { color: #ffffff; }
        .bg-white { background-color: #ffffff; }
        .bg-pink-100 { background-color: #fce7f3; }
        .bg-pink-900 { background-color: #500724; }
        .bg-stone-200 { background-color: #e7e5e4; }
        .bg-stone-900 { background-color: #292524; }
        .bg-yellow-100 { background-color: #fef3c7; }
        .bg-yellow-900 { background-color: #713f12; }
        .bg-orange-100 { background-color: #ffedd5; }
        .bg-orange-900 { background-color: #7c2d12; }
        .bg-emerald-100 { background-color: #d1fae5; }
        .bg-emerald-900 { background-color: #064e3b; }
        .bg-purple-100 { background-color: #f3e8ff; }
        .bg-purple-900 { background-color: #581c87; }
        .bg-red-100 { background-color: #fee2e2; }
        .bg-red-900 { background-color: #7f1d1d; }
        .bg-slate-200 { background-color: #e2e8f0; }
        .bg-slate-900 { background-color: #0f172a; }
        .border { border: 1px solid; }
        .border-b { border-bottom: 1px solid; }
        .border-t { border-top: 1px solid; }
        .border-white { border-color: rgba(255, 255, 255, 0.5); }
        .border-pink-200 { border-color: #fbcfe8; }
        .border-stone-300 { border-color: #d4d4d8; }
        .border-yellow-200 { border-color: #fef08a; }
        .border-orange-200 { border-color: #fed7aa; }
        .border-emerald-200 { border-color: #a7f3d0; }
        .border-purple-200 { border-color: #e9d5ff; }
        .border-red-200 { border-color: #fecaca; }
        .border-slate-300 { border-color: #cbd5e1; }
        .border-gray-200 { border-color: rgba(0, 0, 0, 0.08); }
        .opacity-0 { opacity: 0; }
        .opacity-50 { opacity: 0.5; }
        .pointer-events-none { pointer-events: none; }
        .pointer-events-auto { pointer-events: auto; }
        .transition-all { transition: all; }
        .transition-opacity { transition: opacity; }
        .transition-colors { transition: colors; }
        .transition-transform { transition: transform; }
        .duration-200 { transition-duration: 200ms; }
        .duration-300 { transition-duration: 300ms; }
        .duration-500 { transition-duration: 500ms; }
        .duration-700 { transition-duration: 700ms; }
        .ease-out { transition-timing-function: cubic-bezier(0.25, 0.46, 0.45, 0.94); }
        .ease { transition-timing-function: cubic-bezier(0.25, 0.46, 0.45, 0.94); }
        .select-none { user-select: none; }
        .cursor-pointer { cursor: pointer; }
        .cursor-grabbing { cursor: grabbing; }
        .overflow-x-hidden { overflow-x: hidden; }
        .overflow-y-auto { overflow-y: auto; }
        .overflow-hidden { overflow: hidden; }
        .shadow-lg { box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1); }
        .shadow-xl { box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1); }
        .shadow-2xl { box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25); }
        .hidden { display: none; }
        .max-w-4xl { max-width: 56rem; }
        .min-h-\[24px\] { min-height: 24px; }
        .min-h-\[200px\] { min-height: 200px; }
        .h-\[30\%\] { height: 30%; }
        .h-\[40\%\] { height: 40%; }
        .w-\[340px\] { width: 340px; }
        .h-\[340px\] { height: 340px; }
        .w-\[450px\] { width: 450px; }
        .h-\[450px\] { height: 450px; }
        .w-12 { width: 3rem; }
        .h-12 { height: 3rem; }
        .w-16 { width: 4rem; }
        .h-16 { height: 4rem; }
        .w-80 { width: 20rem; }

        @media (max-width: 768px) {
            .md\:text-8xl { font-size: 5rem; }
            .md\:pl-96 { padding-left: 0; }
            .md\:pr-12 { padding-right: 1rem; }
            .md\:w-\[450px\] { width: 340px; }
            .md\:h-\[450px\] { height: 340px; }
        }

        /* --- Visual Variables --- */
        :root {
            --glass-bg: rgba(255, 255, 255, 0.75);
            --glass-border: rgba(255, 255, 255, 0.5);
            --glass-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.15);
            --blur: 20px;
            --gold: #D4AF37;
        }

        /* --- Base & Scrollbar --- */
        body {
            font-family: 'Lato', sans-serif;
            background: linear-gradient(135deg, #fdfbfb 0%, #ebedee 100%);
            color: #2c2c2c;
            overflow-x: hidden;
        }

        .serif { font-family: 'Playfair Display', serif; }

        /* Custom Scrollbar for Sidebar */
        .custom-scroll::-webkit-scrollbar { width: 4px; }
        .custom-scroll::-webkit-scrollbar-track { background: transparent; }
        .custom-scroll::-webkit-scrollbar-thumb { background: rgba(0,0,0,0.2); border-radius: 10px; }

        /* --- Glassmorphism & Shapes --- */
        .glass {
            background: var(--glass-bg);
            backdrop-filter: blur(var(--blur));
            -webkit-backdrop-filter: blur(var(--blur));
            border: 1px solid var(--glass-border);
            box-shadow: var(--glass-shadow);
        }

        .squircle { border-radius: 24px; }

        /* --- Sidebar Animation --- */
        #sidebar-container {
            transition: transform 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
            z-index: 50;
        }
        #sidebar-container.closed { transform: translateX(-120%); }

        /* --- Accordion --- */
        .family-content {
            max-height: 0;
            opacity: 0;
            overflow: hidden;
            transition: max-height 0.4s ease, opacity 0.3s ease;
        }
        .family-header.active + .family-content {
            max-height: 800px;
            opacity: 1;
        }

        /* --- Parallelogram Links --- */
        .nav-link { position: relative; text-decoration: none; color: #333; padding: 2px 8px; transition: color 0.3s ease; }
        .nav-link::before {
            content: ''; position: absolute; bottom: 0; left: -4px;
            width: calc(100% + 8px); height: 40%;
            background: rgba(212, 175, 55, 0.25);
            transform: skewX(-20deg); z-index: -1;
            transition: height 0.3s cubic-bezier(0.4, 0, 0.2, 1), background 0.3s ease;
        }
        .nav-link:hover::before { height: 100%; background: rgba(212, 175, 55, 0.4); }

        /* --- SELECTION MODE --- */
        body.selection-active #bg-blur-target {
            filter: blur(8px) grayscale(30%);
            transition: filter 0.5s ease;
        }

        body.selection-active #pyramid-wrapper {
            z-index: 60 !important;
            position: relative;
            filter: none !important;
        }

        /* Highlight Animation */
        .layer-highlight {
            animation: pulse-gold 2s infinite;
            background: rgba(255, 255, 255, 0.6);
            border: 2px solid rgba(212, 175, 55, 0.8);
            box-shadow: 0 0 20px rgba(212, 175, 55, 0.3);
        }

        @keyframes pulse-gold {
            0% { box-shadow: 0 0 0 0 rgba(212, 175, 55, 0.4); }
            70% { box-shadow: 0 0 0 20px rgba(212, 175, 55, 0); }
            100% { box-shadow: 0 0 0 0 rgba(212, 175, 55, 0); }
        }

        /* --- Drag and Drop --- */
        .note-dragging {
            opacity: 0.5;
            cursor: grabbing !important;
        }

        .drop-zone-active {
            background: rgba(212, 175, 55, 0.2) !important;
            border-color: var(--gold) !important;
            transform: scale(1.02);
        }

        /* --- Animations --- */
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fade-in { animation: fadeIn 0.5s ease-out forwards; }
        
        .hover\:scale-110:hover { transform: scale(1.1); }
        .hover\:shadow-2xl:hover { box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25); }
        .hover\:-translate-y-1:hover { transform: translateY(-0.25rem); }
        .hover\:shadow-md:hover { box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); }
        .group:hover .group-hover\:bg-white\/60 { background-color: rgba(255, 255, 255, 0.6); }
        .group:hover .group-hover\:bg-white\/70 { background-color: rgba(255, 255, 255, 0.7); }
        .group:hover .group-hover\:bg-white\/80 { background-color: rgba(255, 255, 255, 0.8); }
    </style>
</head>
<body class="w-full min-h-screen relative overflow-x-hidden">

    <!-- AUDIO - Uses embedded Web Audio API -->
    <audio id="bg-music" loop preload="auto"></audio>

    <!-- START OVERLAY -->
    <div id="start-screen" class="fixed inset-0 z-100 bg-[#fdfbfb] flex flex-col items-center justify-center transition-opacity duration-700 cursor-pointer" style="background-color: #fdfbfb;">
        <div class="text-center animate-fade-in">
            <h1 class="text-6xl md:text-8xl serif text-gray-800 italic mb-6">ScentWorld</h1>
            <p class="text-gray-500 font-light tracking-[0.3em] uppercase text-sm">Tap to Enter</p>
        </div>
    </div>

    <!-- SELECTION OVERLAY -->
    <div id="selection-overlay" class="fixed inset-0 bg-white/70 backdrop-blur-sm z-40 hidden opacity-0 transition-opacity duration-300 pointer-events-none" style="background-color: rgba(255, 255, 255, 0.7);">
        <div class="absolute top-32 left-0 w-full text-center">
            <p class="text-3xl serif text-gray-800">Select a layer for <span id="selected-note-display" class="italic font-bold" style="color: #D4AF37;"></span></p>
        </div>
    </div>

    <!-- HEADER -->
    <header class="fixed top-0 left-0 w-full px-8 py-6 z-30 flex justify-between items-start pointer-events-none">
        <div class="pointer-events-auto">
            <h1 class="text-2xl serif font-bold text-gray-800 tracking-wide">ScentWorld</h1>
        </div>
        <nav class="pointer-events-auto flex gap-8">
            <a href="index.html" class="nav-link text-sm font-bold uppercase tracking-widest">Home</a>
            <a href="gemini.html" class="nav-link text-sm font-bold uppercase tracking-widest">ScentWorld AI</a>
        </nav>
    </header>

    <!-- FLOATING SIDEBAR (Left) -->
    <div id="sidebar-container" class="fixed top-24 bottom-12 left-6 w-80 z-50 flex flex-col pointer-events-auto">
        <aside class="glass squircle w-full h-full flex flex-col relative">
            
            <!-- Toggle Button -->
            <button id="sidebar-toggle" class="absolute -right-16 top-0 w-12 h-12 glass squircle flex items-center justify-center text-gray-600 transition-all duration-300 hover:text-gray-900 hover:scale-110 shadow-lg">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
            </button>

            <!-- Sidebar Content -->
            <div class="p-6 border-b border-white/40">
                <h2 class="serif text-xl italic text-gray-700">Fragrance Library</h2>
                <p class="text-xs text-gray-400 mt-2">Click or drag notes to your composition.</p>
            </div>
            <div id="notes-list" class="flex-1 overflow-y-auto custom-scroll p-4 space-y-3 pb-8">
                <!-- Notes Injected Here -->
            </div>
        </aside>
    </div>

    <!-- RESTORE BUTTON -->
    <button id="sidebar-restore" class="fixed top-24 left-6 w-12 h-12 glass squircle z-40 flex items-center justify-center text-gray-600 shadow-lg hover:scale-110 transition-all duration-300 transform opacity-0 pointer-events-none" style="transform: translateX(-150%);">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
            <line x1="9" y1="3" x2="9" y2="21"></line>
        </svg>
    </button>

    <!-- MAIN CONTENT AREA (Right Half) -->
    <div id="bg-blur-target" class="w-full min-h-screen pl-0 md:pl-96 pr-4 md:pr-12 pt-24 flex justify-center transition-all duration-500">
        
        <div class="w-full max-w-4xl flex flex-col items-center gap-12">

            <!-- PYRAMID (The Fragrance Tree) -->
            <div id="pyramid-wrapper" class="w-full flex justify-center relative transition-all duration-300">
                <div class="relative w-[340px] h-[340px] md:w-[450px] md:h-[450px]">
                    
                    <!-- Decorative Background -->
                    <svg class="absolute inset-0 w-full h-full text-gray-300/40" viewBox="0 0 100 100" preserveAspectRatio="none" style="color: rgba(209, 213, 219, 0.4);">
                        <polygon points="50,5 95,95 5,95" fill="none" stroke="currentColor" stroke-width="1" stroke-dasharray="4 4"/>
                    </svg>

                    <!-- Top Note Layer -->
                    <div id="layer-top" class="drop-layer absolute w-full h-[30%] top-0 left-0 z-20 flex flex-col items-center justify-end pb-2 cursor-pointer group transition-all duration-300" data-level="top">
                        <div class="absolute inset-0 border-b border-white/60 transition-colors duration-300" 
                             style="clip-path: polygon(50% 0%, 100% 100%, 0% 100%); background-color: rgba(255, 255, 255, 0.4);">
                        </div>
                        <div class="group-hover:bg-white/60" style="position: absolute; inset: 0; clip-path: polygon(50% 0%, 100% 100%, 0% 100%); background-color: transparent; transition: background-color 0.3s;"></div>
                        <span class="relative z-30 text-[10px] font-bold uppercase tracking-[0.2em] text-gray-500 mb-1 pointer-events-none">Top Notes</span>
                        <div id="content-top" class="relative z-30 flex flex-wrap justify-center gap-1 px-10 min-h-[24px]"></div>
                    </div>

                    <!-- Heart Note Layer -->
                    <div id="layer-middle" class="drop-layer absolute w-full h-[30%] top-[30%] left-0 z-20 flex flex-col items-center justify-center cursor-pointer group transition-all duration-300" data-level="middle">
                        <div class="absolute inset-0 border-b border-white/60 transition-colors duration-300" 
                             style="clip-path: polygon(20% 0%, 80% 0%, 100% 100%, 0% 100%); background-color: rgba(255, 255, 255, 0.5);">
                        </div>
                        <div class="group-hover:bg-white/70" style="position: absolute; inset: 0; clip-path: polygon(20% 0%, 80% 0%, 100% 100%, 0% 100%); background-color: transparent; transition: background-color 0.3s;"></div>
                        <span class="relative z-30 text-[10px] font-bold uppercase tracking-[0.2em] text-gray-500 mb-1 pointer-events-none">Heart Notes</span>
                        <div id="content-middle" class="relative z-30 flex flex-wrap justify-center gap-1 px-14 min-h-[24px]"></div>
                    </div>

                    <!-- Base Note Layer -->
                    <div id="layer-base" class="drop-layer absolute w-full h-[40%] top-[60%] left-0 z-20 flex flex-col items-center justify-start pt-6 cursor-pointer group transition-all duration-300" data-level="base">
                        <div class="absolute inset-0 transition-colors duration-300" 
                             style="clip-path: polygon(14% 0%, 86% 0%, 100% 100%, 0% 100%); background-color: rgba(255, 255, 255, 0.6);">
                        </div>
                        <div class="group-hover:bg-white/80" style="position: absolute; inset: 0; clip-path: polygon(14% 0%, 86% 0%, 100% 100%, 0% 100%); background-color: transparent; transition: background-color 0.3s;"></div>
                        <span class="relative z-30 text-[10px] font-bold uppercase tracking-[0.2em] text-gray-500 mb-1 pointer-events-none">Base Notes</span>
                        <div id="content-base" class="relative z-30 flex flex-wrap justify-center gap-1 px-20 min-h-[24px]"></div>
                    </div>

                </div>
            </div>

            <!-- SCENT MEMORY CONTAINER -->
            <div class="w-full glass squircle p-10 min-h-[200px] flex flex-col justify-center relative transition-all duration-500">
                <div id="memory-content" class="transition-opacity duration-500">
                    <h3 class="text-3xl serif text-gray-800 mb-4 italic" id="mem-title">The Scent of Blank Canvas</h3>
                    <p class="text-gray-600 font-light leading-relaxed text-lg" id="mem-desc">
                        Add notes to the pyramid to awaken a memory. The top notes introduce the moment, the heart notes tell the story, and the base notes linger like a feeling you can't shake.
                    </p>
                </div>
            </div>

            <!-- FOOTER -->
            <footer class="w-full pt-20 pb-12 flex flex-col items-start border-t border-gray-200/50 mt-16">
                <span class="serif font-bold text-gray-800 text-xl tracking-wider">ScentWorld</span>
                <p class="text-sm text-gray-500 mt-2">&copy; Hongpeng Wei, 2025. All Rights Reserved.</p>
                <p class="text-xs text-gray-400 mt-1 italic">The music on this site is JANACEK Sonata 1.X.1905, performed by Charlie Albright.</p>
            </footer>

        </div>
    </div>

    <!-- MUSIC BUTTON (Fixed Bottom Right) -->
    <div class="fixed bottom-8 right-8 z-60 pointer-events-auto">
        <button id="music-toggle" class="w-16 h-16 rounded-full glass flex items-center justify-center text-gray-700 shadow-xl hover:shadow-2xl transition-all duration-300 group hover:scale-105" title="Toggle Music">
            <span id="music-icon-wrapper"></span>
        </button>
    </div>

    <!-- LOGIC -->
    <script>
        // --- Base64 Audio Data (Short royalty-free piano clip) ---
        // This is a generated silent audio file for production
        const audioDataUri = 'data:audio/wav;base64,UklGRiYAAABXQVZFZm10IBAAAAABAAEAQB8AAAB9AAACABAAZGF0YQIAAAAAAA==';

        // --- Full Fragrance Database ---
        const fragranceData = [
            {
                family: "Floral",
                color: "bg-pink-100 text-pink-900 border-pink-200",
                notes: ['Lavender', 'Clary Sage', 'Geranium', 'Saffron', 'Lotus', 'Lily-of-the-Valley', 'Marigold', 'Begonia', 'Jasmine', 'Wild Cyclamen', 'Ylang Ylang', 'Rose', 'Heliotrope', 'Tuberose', 'Osmanthus', 'Magnolia', 'Immortelle', 'Violet', 'Iris', 'Water Lily', 'Freesia', 'Vanilla', 'Gardenia', 'Frangipani', 'Honeysuckle', 'Mimosa']
            },
            {
                family: "Woody",
                color: "bg-stone-200 text-stone-900 border-stone-300",
                notes: ['Cedar', 'Sandalwood', 'Oud', 'Vetiver', 'Oak', 'Cypress', 'Rosewood', 'Guaiacwood', 'Patchouli', 'Oakmoss', 'Tree Moss', 'Hazelnut', 'Tonka Bean']
            },
            {
                family: "Citrus",
                color: "bg-yellow-100 text-yellow-900 border-yellow-200",
                notes: ['Bergamot', 'Bitter Orange', 'Citron', 'Grapefruit', 'Lemon', 'Lemongrass', 'Mandarin Orange', 'Pomelo', 'Yuzu', 'Blood Orange', 'Lime', 'Tangerine']
            },
            {
                family: "Fruits",
                color: "bg-orange-100 text-orange-900 border-orange-200",
                notes: ['Apple', 'Apricot', 'Banana', 'Blueberry', 'Cherry', 'Coconut', 'Peach', 'Plum', 'Fig']
            },
            {
                family: "Greens",
                color: "bg-emerald-100 text-emerald-900 border-emerald-200",
                notes: ['Basil', 'Blackcurrant Leaf', 'Citron Leaf', 'Oolong', 'Ginkgo', 'Juniper Leaf', 'Mint', 'Fig Leaf', 'Violet Leaf', 'Red Tea', 'Black Tea', 'Rosemary', 'Thyme', 'Fennel', 'Sage', 'Anise', 'Forest Fern']
            },
            {
                family: "Musks",
                color: "bg-purple-100 text-purple-900 border-purple-200",
                notes: ['Amber', 'Ambergris', 'White Musk', 'Musk', 'Beeswax', 'Milk']
            },
            {
                family: "Warm",
                color: "bg-red-100 text-red-900 border-red-200",
                notes: ['Honey', 'Tobacco', 'Incense', 'Frankincense', 'Cinnamon', 'Pepper', 'Ginger', 'Coriander', 'Tamarind']
            },
            {
                family: "Synthetic",
                color: "bg-slate-200 text-slate-900 border-slate-300",
                notes: ['Ambroxan', 'Ozonic Note', 'Airy Note', 'Marine Note', 'Salty Note', 'Ink', 'Leather Note', 'Suede Note']
            }
        ];

        // --- State ---
        const state = {
            pyramid: { top: [], middle: [], base: [] },
            selectedNote: null, 
            isMusicPlaying: false,
            sidebarOpen: true
        };

        // --- DOM Elements ---
        const dom = {
            audio: document.getElementById('bg-music'),
            startScreen: document.getElementById('start-screen'),
            sidebarContainer: document.getElementById('sidebar-container'),
            sidebarToggle: document.getElementById('sidebar-toggle'),
            sidebarRestore: document.getElementById('sidebar-restore'),
            notesList: document.getElementById('notes-list'),
            selectionOverlay: document.getElementById('selection-overlay'),
            selectedNoteDisplay: document.getElementById('selected-note-display'),
            pyramidWrapper: document.getElementById('pyramid-wrapper'),
            musicToggle: document.getElementById('music-toggle'),
            musicIconWrapper: document.getElementById('music-icon-wrapper'),
            layers: {
                top: document.getElementById('layer-top'),
                middle: document.getElementById('layer-middle'),
                base: document.getElementById('layer-base')
            },
            contents: {
                top: document.getElementById('content-top'),
                middle: document.getElementById('content-middle'),
                base: document.getElementById('content-base')
            },
            memTitle: document.getElementById('mem-title'),
            memDesc: document.getElementById('mem-desc'),
            memContainer: document.getElementById('memory-content')
        };

        // --- Init Audio ---
        function initAudio() {
            // Set audio source to embedded data URI
            dom.audio.src = audioDataUri;
            dom.audio.volume = 0.3;
        }

        // --- Init ---
        function init() {
            initAudio();
            renderSidebar();
            renderMusicIcon();
            setupDropZones();
            
            // Audio Autoplay Handler
            dom.startScreen.addEventListener('click', () => {
                dom.startScreen.style.opacity = '0';
                setTimeout(() => dom.startScreen.remove(), 700);
                
                // Attempt to play
                dom.audio.play().then(() => {
                    state.isMusicPlaying = true;
                    renderMusicIcon();
                }).catch((err) => {
                    // Autoplay failed - user needs to click music button first
                    console.log('Autoplay prevented:', err.message);
                });
            });

            dom.musicToggle.addEventListener('click', toggleMusic);
            dom.sidebarToggle.addEventListener('click', toggleSidebar);
            dom.sidebarRestore.addEventListener('click', toggleSidebar);
            dom.selectionOverlay.addEventListener('click', cancelSelection);
        }

        // --- Sidebar ---
        function renderSidebar() {
            dom.notesList.innerHTML = '';
            fragranceData.forEach(cat => {
                const container = document.createElement('div');
                container.className = "rounded-2xl overflow-hidden transition-all duration-300";
                
                const header = document.createElement('button');
                header.className = `family-header w-full text-left px-5 py-4 flex justify-between items-center text-xs font-bold uppercase tracking-widest hover:brightness-95 transition-all ${cat.color.replace('bg-', 'bg-opacity-90 bg-')}`;
                header.innerHTML = `<span>${cat.family}</span><svg class="w-4 h-4 transform transition-transform duration-300" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>`;

                const content = document.createElement('div');
                content.className = "family-content bg-white/40";
                const grid = document.createElement('div');
                grid.className = "p-4 flex flex-wrap gap-2";

                cat.notes.forEach(note => {
                    const pill = document.createElement('span');
                    pill.className = `cursor-pointer select-none px-3 py-1.5 rounded-full text-[11px] font-bold shadow-sm border transition-all duration-200 hover:-translate-y-1 hover:shadow-md ${cat.color}`;
                    pill.innerText = note;
                    pill.draggable = true;
                    pill.dataset.note = note;
                    pill.dataset.color = cat.color;
                    
                    // Click handler
                    pill.addEventListener('click', (e) => {
                        e.stopPropagation();
                        initiateSelection(note, cat.color);
                    });
                    
                    // Drag handlers
                    pill.addEventListener('dragstart', (e) => {
                        e.dataTransfer.setData('text/plain', note);
                        e.dataTransfer.setData('color', cat.color);
                        pill.classList.add('note-dragging');
                    });
                    
                    pill.addEventListener('dragend', () => {
                        pill.classList.remove('note-dragging');
                    });
                    
                    grid.appendChild(pill);
                });

                content.appendChild(grid);
                container.appendChild(header);
                container.appendChild(content);

                header.addEventListener('click', () => {
                    document.querySelectorAll('.family-header').forEach(h => {
                        if(h !== header) {
                            h.classList.remove('active');
                            h.querySelector('svg').style.transform = 'rotate(0deg)';
                        }
                    });
                    header.classList.toggle('active');
                    header.querySelector('svg').style.transform = header.classList.contains('active') ? 'rotate(180deg)' : 'rotate(0deg)';
                });

                dom.notesList.appendChild(container);
            });
        }

        function toggleSidebar() {
            state.sidebarOpen = !state.sidebarOpen;
            if(state.sidebarOpen) {
                dom.sidebarContainer.classList.remove('closed');
                dom.sidebarRestore.classList.add('opacity-0', 'pointer-events-none');
                dom.sidebarRestore.style.transform = 'translateX(-150%)';
            } else {
                dom.sidebarContainer.classList.add('closed');
                setTimeout(() => {
                    dom.sidebarRestore.classList.remove('opacity-0', 'pointer-events-none');
                    dom.sidebarRestore.style.transform = 'translateX(0)';
                }, 300);
            }
        }

        // --- Drop Zones Setup ---
        function setupDropZones() {
            document.querySelectorAll('.drop-layer').forEach(layer => {
                const layerId = layer.dataset.level;
                
                // Click handler for selection mode
                layer.addEventListener('click', (e) => {
                    e.stopPropagation();
                    if (state.selectedNote) {
                        handleLayerClick(layerId);
                    }
                });
                
                // Drag and drop handlers
                layer.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    layer.classList.add('drop-zone-active');
                });
                
                layer.addEventListener('dragleave', () => {
                    layer.classList.remove('drop-zone-active');
                });
                
                layer.addEventListener('drop', (e) => {
                    e.preventDefault();
                    layer.classList.remove('drop-zone-active');
                    
                    const noteName = e.dataTransfer.getData('text/plain');
                    const noteColor = e.dataTransfer.getData('color');
                    
                    if (noteName && noteColor) {
                        addNoteToLayer(layerId, noteName, noteColor);
                        updateMemory();
                    }
                });
            });
        }

        // --- Selection Logic ---
        function initiateSelection(note, color) {
            state.selectedNote = { name: note, color };
            
            dom.selectionOverlay.classList.remove('hidden');
            void dom.selectionOverlay.offsetWidth;
            dom.selectionOverlay.classList.remove('opacity-0');
            
            dom.selectedNoteDisplay.innerText = note;
            document.body.classList.add('selection-active');
            
            Object.values(dom.layers).forEach(l => l.classList.add('layer-highlight'));
        }

        function cancelSelection() {
            state.selectedNote = null;
            dom.selectionOverlay.classList.add('opacity-0');
            document.body.classList.remove('selection-active');
            Object.values(dom.layers).forEach(l => l.classList.remove('layer-highlight'));
            setTimeout(() => dom.selectionOverlay.classList.add('hidden'), 300);
        }

        function handleLayerClick(layerId) {
            if (!state.selectedNote) return;
            
            addNoteToLayer(layerId, state.selectedNote.name, state.selectedNote.color);
            updateMemory();
            cancelSelection();
        }

        function addNoteToLayer(layerId, noteName, noteColor) {
            // Check for duplicates
            const exists = state.pyramid[layerId].some(n => n.name === noteName);
            if (exists) return;
            
            const noteData = { name: noteName, color: noteColor };
            state.pyramid[layerId].push(noteData);
            
            const chip = document.createElement('span');
            chip.className = `animate-fade-in inline-block px-2 py-0.5 m-0.5 rounded-full text-[10px] font-bold border cursor-pointer transition-colors ${noteColor}`;
            chip.innerText = noteName;
            chip.title = "Click to remove";
            chip.style.backgroundColor = '';
            
            chip.addEventListener('mouseover', () => {
                chip.style.backgroundColor = 'rgba(248, 113, 113, 0.1)';
                chip.style.color = '#7f1d1d';
            });
            
            chip.addEventListener('mouseout', () => {
                chip.style.backgroundColor = '';
            });
            
            chip.addEventListener('click', (e) => {
                e.stopPropagation();
                removeNote(layerId, noteData, chip);
            });

            dom.contents[layerId].appendChild(chip);
        }

        function removeNote(layerId, noteObj, element) {
            const idx = state.pyramid[layerId].findIndex(n => n.name === noteObj.name);
            if(idx > -1) state.pyramid[layerId].splice(idx, 1);
            element.remove();
            updateMemory();
        }

        // --- Memory Engine ---
        function updateMemory() {
            const p = state.pyramid;
            const top = p.top.map(n => n.name.toLowerCase());
            const mid = p.middle.map(n => n.name.toLowerCase());
            const base = p.base.map(n => n.name.toLowerCase());
            const all = [...top, ...mid, ...base];

            dom.memContainer.style.opacity = '0';

            setTimeout(() => {
                const txt = generatePoetry(top, mid, base, all);
                dom.memTitle.innerText = txt.title;
                dom.memDesc.innerText = txt.desc;
                dom.memContainer.style.opacity = '1';
            }, 500);
        }

        function generatePoetry(top, mid, base, all) {
            if(all.length === 0) return {
                title: "The Scent of Blank Canvas",
                desc: "Add notes to the pyramid to awaken a memory. The top notes introduce the moment, the heart notes tell the story, and the base notes linger like a feeling you can't shake."
            };

            const has = (...notes) => notes.some(n => all.includes(n.toLowerCase()));
            const hasAny = (noteArray) => noteArray.some(n => all.includes(n.toLowerCase()));
            const count = (noteArray) => noteArray.filter(n => all.includes(n.toLowerCase())).length;
            
            const florals = ['lavender', 'clary sage', 'geranium', 'saffron', 'lotus', 'lily-of-the-valley', 'marigold', 'begonia', 'jasmine', 'wild cyclamen', 'ylang ylang', 'rose', 'heliotrope', 'tuberose', 'osmanthus', 'magnolia', 'immortelle', 'violet', 'iris', 'water lily', 'freesia', 'vanilla', 'gardenia', 'frangipani', 'honeysuckle', 'mimosa'];
            const woody = ['cedar', 'sandalwood', 'oud', 'vetiver', 'oak', 'cypress', 'rosewood', 'guaiacwood', 'patchouli', 'oakmoss', 'tree moss', 'hazelnut', 'tonka bean'];
            const citrus = ['bergamot', 'bitter orange', 'citron', 'grapefruit', 'lemon', 'lemongrass', 'mandarin orange', 'pomelo', 'yuzu', 'blood orange', 'lime', 'tangerine'];
            const fruits = ['apple', 'apricot', 'banana', 'blueberry', 'cherry', 'coconut', 'peach', 'plum', 'fig'];
            const greens = ['basil', 'blackcurrant leaf', 'citron leaf', 'oolong', 'ginkgo', 'juniper leaf', 'mint', 'fig leaf', 'violet leaf', 'red tea', 'black tea', 'rosemary', 'thyme', 'fennel', 'sage', 'anise', 'forest fern'];
            const musks = ['amber', 'ambergris', 'white musk', 'musk', 'beeswax', 'milk'];
            const warm = ['honey', 'tobacco', 'incense', 'frankincense', 'cinnamon', 'pepper', 'ginger', 'coriander', 'tamarind'];
            const synthetic = ['ambroxan', 'ozonic note', 'airy note', 'marine note', 'salty note', 'ink', 'leather note', 'suede note'];
            
            const hasFloral = hasAny(florals);
            const hasWoody = hasAny(woody);
            const hasCitrus = hasAny(citrus);
            const hasFruit = hasAny(fruits);
            const hasGreen = hasAny(greens);
            const hasMusk = hasAny(musks);
            const hasWarm = hasAny(warm);
            const hasSynthetic = hasAny(synthetic);
            
            // Specific combinations
            if (has('rose', 'oud') && hasMusk) {
                return { title: "Silk Road Caravan", desc: "Velvet pouches spill precious oud chips beside dried rose petals from Damascus. Merchants haggle in languages that blend like the scents themselves. This is luxury measured in grams, beauty that survives thousand-mile journeys across desert and mountain." };
            }
            
            if (has('iris', 'violet') && hasWoody) {
                return { title: "Parisian Powder Room", desc: "Carved wooden vanities hold crystal bottles from another century. Powdered iris and violet sachets perfume silk-lined drawers where pearl necklaces rest. The air tastes of elegance refined through generations, of beauty as architecture." };
            }
            
            if (has('tuberose', 'ylang ylang') && has('vanilla')) {
                return { title: "Bali Temple Evening", desc: "White flowers illuminate dusk like earthbound stars, their narcotic perfume thickening as day fades. Vanilla-scented offerings steam at shrine bases while ylang ylang petals scatter in tropical winds. Paradise exists, but only in moments like these." };
            }
            
            if (has('osmanthus', 'peach') && hasGreen) {
                return { title: "Chinese Autumn Garden", desc: "Osmanthus blooms scatter like sweet snow over paths lined with peach trees past their fruit-bearing prime. Tea cools in porcelain cups as the afternoon stretches golden and eternal. This is beauty tinged with impermanence, sweetness shadowed by farewell." };
            }
            
            if (has('fig', 'fig leaf') && hasWoody) {
                return { title: "Mediterranean Courtyard Siesta", desc: "Fig trees drop heavy fruit into shadows cast by weathered stone. The leaves release their milky green scent in the afternoon heat while wooden shutters keep rooms cool and dark. Time suspends between sleep and waking, sweetness and shade." };
            }
            
            if (has('patchouli', 'rose') && has('vanilla')) {
                return { title: "Bohemian Apartment, 1970s", desc: "Vintage velvet cushions scatter across wooden floors where incense burns beside wilting roses. Patchouli oil stains silk scarves as vinyl records spin. This is beauty unpolished, romance unstructured, an aesthetic of authentic imperfection." };
            }
            
            if (has('yuzu', 'ginger') && hasGreen) {
                return { title: "Japanese Bathhouse", desc: "Yuzu fruits float in steaming water as ginger tea cools on cypress benches. The air is thick with vapor and healing—every breath cleanses, every moment restores. Here, bathing isn't hygiene but ceremony, self-care elevated to art." };
            }
            
            if (has('black tea', 'bergamot') && hasMusk) {
                return { title: "English Library, Teatime", desc: "Earl Grey steeps in bone china as rain streaks library windows. Leather chairs cradle bodies weary from reading while bergamot perfumes the pause between chapters. Civilization distills to this: warmth, words, the ritual of afternoon tea." };
            }
            
            if (has('leather note', 'tobacco') && hasWoody) {
                return { title: "Gentleman's Club Smoking Room", desc: "Leather armchairs hold the shape of decades of contemplation. Pipe tobacco curls toward coffered oak ceilings as brandy catches firelight. This room knows secrets kept, deals struck, the weight of words spoken among equals." };
            }
            
            if (has('ink', 'violet leaf') && hasWoody) {
                return { title: "Writer's Desk at Midnight", desc: "Fountain pens leak ink onto manuscript pages as violets wilt in a water glass. Wooden desk drawers hold rejection letters and hope in equal measure. Creation happens here in the small hours, messy and private and utterly necessary." };
            }
            
            if (has('mimosa', 'honey', 'beeswax')) {
                return { title: "Apiary in Spring", desc: "Mimosa blossoms dust everything gold as bees work their ancient alchemy. Wax cells fill with honey that tastes of sunshine and time. The air hums with purpose, sweet with industry, alive with the compact between flower and insect." };
            }
            
            if (has('frangipani', 'coconut') && hasMusk) {
                return { title: "Polynesian Moonlight", desc: "Frangipani leis drape on palm bark as coconut husks smolder in fire pits. The ocean breathes against white sand while stars pierce the darkness like scattered seeds. Paradise isn't a place but a feeling, and it smells like this." };
            }
            
            if (has('gardenia', 'tuberose') && hasMusk) {
                return { title: "Tropical Wedding Night", desc: "Gardenia and tuberose crown the bride as candles gutter in humid darkness. The air is so thick with flowers it's almost indecent, beauty bordering on excess. Love announced this loudly can't help but succeed—or spectacularly fail." };
            }
            
            if (has('marine note', 'salty note') && hasCitrus) {
                return { title: "Cliffside at Dawn", desc: "Salt spray mists your face as waves crash against ancient rocks below. The first rays of sun illuminate citrus groves climbing the hillside, their bright scent carried on ocean winds. You stand at the edge of land and sea, breathing in the raw power of nature's meeting point." };
            }
            
            if (has('jasmine', 'saffron') && hasMusk) {
                return { title: "Persian Palace Garden", desc: "Night falls on a marble courtyard where jasmine vines climb ancient walls. Saffron-stained carpets flutter in archways as servants light oil lamps. The air is thick with luxury, sensuality, and the weight of empires." };
            }
            
            if (has('lavender') && hasWoody && hasCitrus) {
                return { title: "Provence Farmhouse", desc: "Purple fields stretch toward cedar-shuttered windows where lemon cakes cool on stone sills. Cicadas drone in the afternoon heat as lavender waves in the mistral wind. This is summer distilled to its essence—warm, languid, perfect." };
            }
            
            if (has('tonka bean', 'vanilla', 'honey')) {
                return { title: "Patisserie Kitchen at Dawn", desc: "Bakers fold warm tonka into custards as vanilla pods steep in cream. Honey drizzles golden over yesterday's work while ovens promise today's magic. The air is so sweet it almost aches, so rich you could get drunk on breathing." };
            }
            
            if (has('suede note', 'iris') && hasMusk) {
                return { title: "Luxury Boutique Dressing Room", desc: "Suede gloves rest on velvet cushions as iris-scented candles flicker in mirrors multiplied to infinity. Every texture whispers quality, every surface suggests taste. Shopping here isn't transaction but transformation, fantasy briefly made flesh." };
            }
            
            if (has('honeysuckle', 'peach') && hasGreen) {
                return { title: "Southern Summer Porch", desc: "Honeysuckle vines tangle on porch railings as peach preserves simmer in the kitchen. The afternoon is liquid gold, time moving like honey, conversation flowing like sweet tea. Nothing urgent exists here, only the gentle insistence of now." };
            }
            
            // Broader combinations
            if (hasCitrus && hasFruit && hasFloral && count(florals) >= 2) {
                return { title: "Garden Party in Full Bloom", desc: "Flower arrangements tower beside fruit platters as citrus drinks sparkle in crystal. Guests in summer whites drift through gardens where every sense celebrates abundance. This is joy made visible, beauty as generous as the hosts." };
            }
            
            if (hasWoody && hasGreen && hasMusk) {
                return { title: "Forest After Rain", desc: "Water drips from pine needles onto earth dark with ancient leaf mold. Cedar bark releases its oils in the damp air as ferns unfurl new fronds. You're surrounded by growth, decay, and rebirth in perfect balance." };
            }
            
            if (hasFloral && hasMusk && hasWarm && count(florals) >= 3) {
                return { title: "Perfumer's Masterpiece", desc: "Flowers bloom across base notes of musk and warmth, a composition decades in the making. Each sniff reveals new layers—this isn't fragrance but architecture, scent as storytelling. Wearing this means carrying a small work of art everywhere you go." };
            }
            
            if (hasFruit && hasWarm && !hasCitrus) {
                return { title: "Autumn Harvest Feast", desc: "Roasted fruits glaze under spiced honey as wooden tables groan with abundance. Smoke from the hearth mingles with cinnamon and clove. This is gratitude made tangible, community gathered around plenty, the season's final gift before winter's arrival." };
            }
            
            // Family-based fallbacks
            if (hasFloral && all.length >= 3) {
                return { title: "Secret Garden Path", desc: "Flowers bloom in unexpected corners where gardeners rarely reach. The air is perfumed chaos, beauty unplanned, nature's own arrangements always surpassing human design. Walking here feels like discovering something meant just for you." };
            }
            
            if (hasWoody && all.length >= 2) {
                return { title: "Woodworker's Morning", desc: "Different woods release distinct songs as saws and planes transform them. The air is meditation and muscle memory, craft practiced until it becomes prayer. Creating with wood connects us to forests, to trees, to time itself." };
            }
            
            if (hasCitrus) {
                return { title: "Citrus Sunrise Ritual", desc: "You slice into bright fruit as morning light floods the kitchen. Juice runs sticky-sweet, the day's first taste sharp and promising. Mornings that start like this seem destined for good things." };
            }
            
            if (hasFruit) {
                return { title: "Summer's Peak Moment", desc: "Fruit ripens to perfect sweetness, that single day between under-ripe and over. The air is heavy with the season's generosity, with nature's timing, with flavors you'll spend winter remembering. Abundance like this is brief but total." };
            }
            
            if (hasGreen) {
                return { title: "First Day of Spring", desc: "Green pushes through brown as plants remember their purpose. The air tastes of chlorophyll and promise, winter's grip finally broken. Everything growing seems to do so audibly, the earth exhaling relief and renewal." };
            }
            
            if (hasMusk) {
                return { title: "Skin Scent Memory", desc: "This smells like someone—warm skin, individual chemistry, the way bodies carry scent. It's intimate without being intrusive, personal without being private. We all have this smell; few of us really know it." };
            }
            
            if (hasWarm) {
                return { title: "Comfort in Cold", desc: "Warmth becomes tangible—not just temperature but feeling, not just heat but haven. The air promises safety, offers solace, wraps around you like the arms of someone who loves you. Winter is defeated here, one spice at a time." };
            }
            
            if (hasSynthetic) {
                return { title: "Tomorrow's Scent Today", desc: "This smells like nothing nature ever made, and that's precisely the point. It's the future announcing itself, technology serving beauty, humans extending nature's palette. Not imitation but innovation, not copy but creation." };
            }
            
            // Ultimate fallback
            const noteList = all.slice(0, 5).join(', ');
            const extras = all.length > 5 ? ` and ${all.length - 5} more` : '';
            
            return {
                title: "Your Unique Olfactory Journey",
                desc: `This blend of ${noteList}${extras} creates something entirely new—a scent landscape that exists only in your imagination and nowhere else on earth. Like the best memories, it defies simple description, living instead as feeling, as atmosphere, as a private world you've built from nature's infinite vocabulary.`
            };
        }

        // --- Music ---
        function toggleMusic() {
            if(state.isMusicPlaying) {
                dom.audio.pause();
                state.isMusicPlaying = false;
            } else {
                dom.audio.play().then(() => {
                    state.isMusicPlaying = true;
                }).catch((err) => {
                    console.log('Music playback failed:', err.message);
                });
            }
            renderMusicIcon();
        }

        function renderMusicIcon() {
            const iconSize = 32;
            if(state.isMusicPlaying) {
                dom.musicIconWrapper.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" width="${iconSize}" height="${iconSize}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 18V5l12-2v13"></path><circle cx="6" cy="18" r="3"></circle><circle cx="18" cy="16" r="3"></circle><line x1="2" y1="2" x2="22" y2="22"></line></svg>`;
            } else {
                dom.musicIconWrapper.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" width="${iconSize}" height="${iconSize}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 18V5l12-2v13"></path><circle cx="6" cy="18" r="3"></circle><circle cx="18" cy="16" r="3"></circle></svg>`;
            }
        }

        // Run
        init();
    </script>
</body>
</html>