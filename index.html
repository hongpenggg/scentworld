<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fragrance Playground</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Georgia', serif;
            background: linear-gradient(135deg, #fdfcfb 0%, #e2d1c3 100%);
            min-height: 100vh;
            display: flex;
            overflow: hidden;
        }

        .sidebar {
            width: 280px;
            background: rgba(255, 255, 255, 0.95);
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
            overflow-y: auto;
            transition: margin-left 0.3s ease;
            position: relative;
            z-index: 10;
        }

        .sidebar.collapsed {
            margin-left: -280px;
        }

        .toggle-btn {
            position: absolute;
            right: -40px;
            top: 20px;
            background: rgba(255, 255, 255, 0.95);
            border: none;
            padding: 10px 15px;
            cursor: pointer;
            border-radius: 0 5px 5px 0;
            box-shadow: 2px 2px 5px rgba(0,0,0,0.1);
            font-size: 18px;
        }

        .sidebar-header {
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .sidebar-header h2 {
            font-size: 20px;
            margin-bottom: 5px;
        }

        .sidebar-header p {
            font-size: 12px;
            opacity: 0.9;
        }

        .family {
            border-bottom: 1px solid #eee;
        }

        .family-header {
            padding: 15px 20px;
            background: #f8f8f8;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: bold;
            color: #555;
        }

        .family-header:hover {
            background: #f0f0f0;
        }

        .family-notes {
            padding: 10px;
            display: none;
        }

        .family.open .family-notes {
            display: block;
        }

        .family.open .arrow {
            transform: rotate(90deg);
        }

        .arrow {
            transition: transform 0.3s ease;
        }

        .note {
            background: white;
            padding: 8px 12px;
            margin: 5px;
            border-radius: 20px;
            cursor: move;
            display: inline-block;
            border: 2px solid #ddd;
            font-size: 13px;
            transition: all 0.2s ease;
        }

        .note:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
            border-color: #667eea;
        }

        .note.dragging {
            opacity: 0.5;
        }

        .main-content {
            flex: 1;
            padding: 40px;
            overflow-y: auto;
        }

        .title {
            text-align: center;
            margin-bottom: 40px;
        }

        .title h1 {
            font-size: 36px;
            color: #333;
            margin-bottom: 10px;
        }

        .title p {
            color: #666;
            font-style: italic;
        }

        .pyramid-container {
            max-width: 600px;
            margin: 0 auto 40px;
        }

        .pyramid-level {
            margin: 15px 0;
            text-align: center;
        }

        .level-label {
            font-size: 14px;
            color: #666;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .drop-zone {
            min-height: 80px;
            background: rgba(255, 255, 255, 0.8);
            border: 2px dashed #ccc;
            border-radius: 10px;
            padding: 15px;
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            justify-content: center;
            align-items: center;
            transition: all 0.3s ease;
        }

        .drop-zone.drag-over {
            background: rgba(102, 126, 234, 0.1);
            border-color: #667eea;
            transform: scale(1.02);
        }

        .drop-zone.top {
            width: 50%;
            margin: 0 auto;
        }

        .drop-zone.heart {
            width: 70%;
            margin: 0 auto;
        }

        .drop-zone.base {
            width: 90%;
            margin: 0 auto;
        }

        .placed-note {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 13px;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .remove-btn {
            background: rgba(255, 255, 255, 0.3);
            border: none;
            color: white;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 12px;
            line-height: 1;
        }

        .remove-btn:hover {
            background: rgba(255, 255, 255, 0.5);
        }

        .memory-scene {
            max-width: 700px;
            margin: 0 auto;
            padding: 30px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            min-height: 200px;
        }

        .memory-scene h3 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 22px;
        }

        .memory-scene p {
            color: #555;
            line-height: 1.8;
            font-size: 16px;
        }

        .memory-scene.empty {
            text-align: center;
            color: #999;
        }
    </style>
</head>
<body>
    <div class="sidebar" id="sidebar">
        <button class="toggle-btn" onclick="toggleSidebar()">‚ò∞</button>
        <div class="sidebar-header">
            <h2>Fragrance Notes</h2>
            <p>Drag notes to create your blend</p>
        </div>
        
        <div class="family open">
            <div class="family-header" onclick="toggleFamily(this)">
                <span>üå∏ Floral</span>
                <span class="arrow">‚ñ∂</span>
            </div>
            <div class="family-notes">
                <div class="note" draggable="true" data-note="lavender" data-family="floral">Lavender</div>
                <div class="note" draggable="true" data-note="clary sage" data-family="floral">Clary Sage</div>
                <div class="note" draggable="true" data-note="geranium" data-family="floral">Geranium</div>
                <div class="note" draggable="true" data-note="saffron" data-family="floral">Saffron</div>
                <div class="note" draggable="true" data-note="lotus" data-family="floral">Lotus</div>
                <div class="note" draggable="true" data-note="lily-of-the-valley" data-family="floral">Lily-of-the-Valley</div>
                <div class="note" draggable="true" data-note="marigold" data-family="floral">Marigold</div>
                <div class="note" draggable="true" data-note="begonia" data-family="floral">Begonia</div>
                <div class="note" draggable="true" data-note="jasmine" data-family="floral">Jasmine</div>
                <div class="note" draggable="true" data-note="wild cyclamen" data-family="floral">Wild Cyclamen</div>
            </div>
        </div>

        <div class="family open">
            <div class="family-header" onclick="toggleFamily(this)">
                <span>üå≤ Woody</span>
                <span class="arrow">‚ñ∂</span>
            </div>
            <div class="family-notes">
                <div class="note" draggable="true" data-note="cedar" data-family="woody">Cedar</div>
                <div class="note" draggable="true" data-note="sandalwood" data-family="woody">Sandalwood</div>
                <div class="note" draggable="true" data-note="oud" data-family="woody">Oud</div>
                <div class="note" draggable="true" data-note="vetiver" data-family="woody">Vetiver</div>
                <div class="note" draggable="true" data-note="oak" data-family="woody">Oak</div>
                <div class="note" draggable="true" data-note="cypress" data-family="woody">Cypress</div>
            </div>
        </div>

        <div class="family">
            <div class="family-header" onclick="toggleFamily(this)">
                <span>üçä Citrus</span>
                <span class="arrow">‚ñ∂</span>
            </div>
            <div class="family-notes">
                <div class="note" draggable="true" data-note="bergamot" data-family="citrus">Bergamot</div>
                <div class="note" draggable="true" data-note="bitter orange" data-family="citrus">Bitter Orange</div>
                <div class="note" draggable="true" data-note="citron" data-family="citrus">Citron</div>
                <div class="note" draggable="true" data-note="grapefruit" data-family="citrus">Grapefruit</div>
                <div class="note" draggable="true" data-note="lemon" data-family="citrus">Lemon</div>
                <div class="note" draggable="true" data-note="lemongrass" data-family="citrus">Lemongrass</div>
                <div class="note" draggable="true" data-note="mandarin orange" data-family="citrus">Mandarin Orange</div>
            </div>
        </div>

        <div class="family">
            <div class="family-header" onclick="toggleFamily(this)">
                <span>üçé Fruit</span>
                <span class="arrow">‚ñ∂</span>
            </div>
            <div class="family-notes">
                <div class="note" draggable="true" data-note="apple" data-family="fruit">Apple</div>
                <div class="note" draggable="true" data-note="apricot" data-family="fruit">Apricot</div>
                <div class="note" draggable="true" data-note="banana" data-family="fruit">Banana</div>
                <div class="note" draggable="true" data-note="blueberry" data-family="fruit">Blueberry</div>
                <div class="note" draggable="true" data-note="cherry" data-family="fruit">Cherry</div>
                <div class="note" draggable="true" data-note="coconut" data-family="fruit">Coconut</div>
            </div>
        </div>

        <div class="family">
            <div class="family-header" onclick="toggleFamily(this)">
                <span>üåø Greens</span>
                <span class="arrow">‚ñ∂</span>
            </div>
            <div class="family-notes">
                <div class="note" draggable="true" data-note="basil" data-family="greens">Basil</div>
                <div class="note" draggable="true" data-note="blackcurrant leaf" data-family="greens">Blackcurrant Leaf</div>
                <div class="note" draggable="true" data-note="citron leaf" data-family="greens">Citron Leaf</div>
                <div class="note" draggable="true" data-note="oolong" data-family="greens">Oolong</div>
                <div class="note" draggable="true" data-note="ginkgo" data-family="greens">Ginkgo</div>
                <div class="note" draggable="true" data-note="juniper leaf" data-family="greens">Juniper Leaf</div>
                <div class="note" draggable="true" data-note="mint" data-family="greens">Mint</div>
            </div>
        </div>

        <div class="family">
            <div class="family-header" onclick="toggleFamily(this)">
                <span>ü¶å Musks</span>
                <span class="arrow">‚ñ∂</span>
            </div>
            <div class="family-notes">
                <div class="note" draggable="true" data-note="amber" data-family="musk">Amber</div>
                <div class="note" draggable="true" data-note="ambergris" data-family="musk">Ambergris</div>
                <div class="note" draggable="true" data-note="white musk" data-family="musk">White Musk</div>
                <div class="note" draggable="true" data-note="musk" data-family="musk">Musk</div>
            </div>
        </div>

        <div class="family">
            <div class="family-header" onclick="toggleFamily(this)">
                <span>üî• Warm</span>
                <span class="arrow">‚ñ∂</span>
            </div>
            <div class="family-notes">
                <div class="note" draggable="true" data-note="honey" data-family="warm">Honey</div>
                <div class="note" draggable="true" data-note="tobacco" data-family="warm">Tobacco</div>
                <div class="note" draggable="true" data-note="incense" data-family="warm">Incense</div>
                <div class="note" draggable="true" data-note="frankincense" data-family="warm">Frankincense</div>
            </div>
        </div>

        <div class="family">
            <div class="family-header" onclick="toggleFamily(this)">
                <span>‚ö° Synthetic</span>
                <span class="arrow">‚ñ∂</span>
            </div>
            <div class="family-notes">
                <div class="note" draggable="true" data-note="ambroxan" data-family="synthetic">Ambroxan</div>
                <div class="note" draggable="true" data-note="ozonic note" data-family="synthetic">Ozonic Note</div>
                <div class="note" draggable="true" data-note="airy note" data-family="synthetic">Airy Note</div>
                <div class="note" draggable="true" data-note="marine note" data-family="synthetic">Marine Note</div>
                <div class="note" draggable="true" data-note="salty note" data-family="synthetic">Salty Note</div>
            </div>
        </div>
    </div>

    <div class="main-content">
        <div class="title">
            <h1>Fragrance Playground</h1>
            <p>Create your perfect scent memory by blending notes</p>
        </div>

        <div class="pyramid-container">
            <div class="pyramid-level">
                <div class="level-label">Top Notes</div>
                <div class="drop-zone top" data-level="top"></div>
            </div>

            <div class="pyramid-level">
                <div class="level-label">Heart Notes</div>
                <div class="drop-zone heart" data-level="heart"></div>
            </div>

            <div class="pyramid-level">
                <div class="level-label">Base Notes</div>
                <div class="drop-zone base" data-level="base"></div>
            </div>
        </div>

        <div class="memory-scene empty" id="memoryScene">
            <p>Start adding notes to discover your memory scene...</p>
        </div>
    </div>

    <script>
        const composition = {
            top: [],
            heart: [],
            base: []
        };

        // Drag and drop functionality
        document.querySelectorAll('.note').forEach(note => {
            note.addEventListener('dragstart', (e) => {
                e.dataTransfer.setData('text/plain', e.target.dataset.note);
                e.target.classList.add('dragging');
            });

            note.addEventListener('dragend', (e) => {
                e.target.classList.remove('dragging');
            });
        });

        document.querySelectorAll('.drop-zone').forEach(zone => {
            zone.addEventListener('dragover', (e) => {
                e.preventDefault();
                zone.classList.add('drag-over');
            });

            zone.addEventListener('dragleave', () => {
                zone.classList.remove('drag-over');
            });

            zone.addEventListener('drop', (e) => {
                e.preventDefault();
                zone.classList.remove('drag-over');
                
                const noteName = e.dataTransfer.getData('text/plain');
                const level = zone.dataset.level;
                
                addNoteToLevel(noteName, level, zone);
                updateMemoryScene();
            });
        });

        function addNoteToLevel(noteName, level, zone) {
            if (composition[level].includes(noteName)) return;
            
            composition[level].push(noteName);
            
            const placedNote = document.createElement('div');
            placedNote.className = 'placed-note';
            placedNote.innerHTML = `
                ${noteName}
                <button class="remove-btn" onclick="removeNote('${noteName}', '${level}')">√ó</button>
            `;
            
            zone.appendChild(placedNote);
        }

        function removeNote(noteName, level) {
            composition[level] = composition[level].filter(n => n !== noteName);
            updateDropZone(level);
            updateMemoryScene();
        }

        function updateDropZone(level) {
            const zone = document.querySelector(`.drop-zone.${level}`);
            zone.innerHTML = '';
            composition[level].forEach(noteName => {
                const placedNote = document.createElement('div');
                placedNote.className = 'placed-note';
                placedNote.innerHTML = `
                    ${noteName}
                    <button class="remove-btn" onclick="removeNote('${noteName}', '${level}')">√ó</button>
                `;
                zone.appendChild(placedNote);
            });
        }

        function updateMemoryScene() {
            const scene = document.getElementById('memoryScene');
            const allNotes = [...composition.top, ...composition.heart, ...composition.base];
            
            if (allNotes.length === 0) {
                scene.className = 'memory-scene empty';
                scene.innerHTML = '<p>Start adding notes to discover your memory scene...</p>';
                return;
            }

            scene.className = 'memory-scene';
            const memory = generateMemoryScene(allNotes, composition);
            scene.innerHTML = `
                <h3>${memory.title}</h3>
                <p>${memory.description}</p>
            `;
        }

        function generateMemoryScene(allNotes, comp) {
            // Helper function to check if notes contain certain elements
            const has = (...notes) => notes.some(n => allNotes.includes(n));
            const hasAny = (noteArray) => noteArray.some(n => allNotes.includes(n));
            
            // Define note categories
            const florals = ['lavender', 'clary sage', 'geranium', 'saffron', 'lotus', 'lily-of-the-valley', 'marigold', 'begonia', 'jasmine', 'wild cyclamen'];
            const woody = ['cedar', 'sandalwood', 'oud', 'vetiver', 'oak', 'cypress'];
            const citrus = ['bergamot', 'bitter orange', 'citron', 'grapefruit', 'lemon', 'lemongrass', 'mandarin orange'];
            const fruits = ['apple', 'apricot', 'banana', 'blueberry', 'cherry', 'coconut'];
            const greens = ['basil', 'blackcurrant leaf', 'citron leaf', 'oolong', 'ginkgo', 'juniper leaf', 'mint'];
            const musks = ['amber', 'ambergris', 'white musk', 'musk'];
            const warm = ['honey', 'tobacco', 'incense', 'frankincense'];
            const synthetic = ['ambroxan', 'ozonic note', 'airy note', 'marine note', 'salty note'];
            
            const hasFloral = hasAny(florals);
            const hasWoody = hasAny(woody);
            const hasCitrus = hasAny(citrus);
            const hasFruit = hasAny(fruits);
            const hasGreen = hasAny(greens);
            const hasMusk = hasAny(musks);
            const hasWarm = hasAny(warm);
            const hasSynthetic = hasAny(synthetic);
            
            // Specific combinations - order matters (more specific first)
            
            // Marine/Synthetic combinations
            if (has('marine note', 'salty note') && hasCitrus) {
                return {
                    title: "Cliffside at Dawn",
                    description: "Salt spray mists your face as waves crash against ancient rocks below. The first rays of sun illuminate citrus groves climbing the hillside, their bright scent carried on ocean winds. You stand at the edge of land and sea, breathing in the raw power of nature's meeting point."
                };
            }
            
            if (has('ozonic note') && hasCitrus && hasGreen) {
                return {
                    title: "After the Storm",
                    description: "Rain-washed air sparkles with electricity as storm clouds retreat over distant hills. Crushed leaves and bright citrus mingle in puddles reflecting clearing skies. Everything feels impossibly clean, renewed, alive with possibility."
                };
            }
            
            if (has('marine note') && hasWoody) {
                return {
                    title: "Driftwood Beach",
                    description: "Weathered timber stretches along endless sand, smoothed by years of tides. Salt air mingles with the ghost of ancient forests, creating a scent both fresh and eternal. Seabirds call overhead as foam traces patterns in the wet shore."
                };
            }
            
            // Citrus dominant combinations
            if (hasCitrus && hasFruit && hasFloral) {
                return {
                    title: "Mediterranean Orchard",
                    description: "Sunlight filters through lemon trees heavy with fruit, their blossoms perfuming the warm air. Stone walls radiate heat as bees drift between orange blossoms and wild herbs. Time moves slowly here, measured in the ripening of fruit and the lengthening of shadows."
                };
            }
            
            if (hasCitrus && hasGreen && hasMusk) {
                return {
                    title: "Secret Garden Path",
                    description: "A hidden trail winds through an overgrown estate, where bergamot trees lean over moss-covered stones. Fresh herbs crush underfoot, releasing aromatic oils that blend with the garden's mysterious, animalic warmth. This place remembers centuries of careful tending and wild abandon."
                };
            }
            
            if (hasCitrus && hasWoody && comp.top.length >= 2) {
                return {
                    title: "Italian Bergamot Grove",
                    description: "Morning mist clings to terraced hillsides where bergamot trees grow between ancient cedars. The air is sharp with citrus zest and rich wood sap, a combination that speaks of traditions handed down through generations. Somewhere below, the Mediterranean glimmers."
                };
            }
            
            // Fruity combinations
            if (hasFruit && hasFloral && hasWarm) {
                return {
                    title: "Harvest Festival",
                    description: "Market stalls overflow with ripe stone fruits and jams simmering in copper pots. Flower garlands frame doorways as honey cakes cool on windowsills. The whole village celebrates abundance, sweet and golden and alive with joy."
                };
            }
            
            if (has('coconut') && hasFloral && hasMusk) {
                return {
                    title: "Tropical Night Garden",
                    description: "Moonlight silvers palm fronds swaying over night-blooming flowers. Coconut husks scatter the sand as warm breezes carry jasmine and something deeper, almost animal. The boundary between paradise and wilderness blurs in the velvet darkness."
                };
            }
            
            if (hasFruit && hasCitrus && hasGreen) {
                return {
                    title: "Summer Breakfast Terrace",
                    description: "Morning light dances on a table laden with fresh fruit and herb-infused waters. Citrus slices float in crystal pitchers as mint leaves perfume the air. Every breath tastes of vacation, leisure, and the simple pleasure of sun-warmed fruit."
                };
            }
            
            // Green dominant combinations
            if (hasGreen && hasWoody && has('oolong')) {
                return {
                    title: "Mountain Tea House",
                    description: "Steam rises from earthenware cups in a wooden pavilion perched above cloud forests. The scent of oolong tea mingles with cypress wood and fresh mountain herbs. Silence here is not empty but full‚Äîof breath, of contemplation, of peace."
                };
            }
            
            if (has('mint', 'basil') && hasCitrus) {
                return {
                    title: "Chef's Herb Garden",
                    description: "Sunlight warms a kitchen garden where mint and basil grow wild beside lemon trees. You run your fingers through leaves, releasing oils that make your mouth water. This is the scent of home-cooked meals and summer dinners stretching into starlight."
                };
            }
            
            if (hasGreen && hasMusk && hasFloral) {
                return {
                    title: "Victorian Greenhouse",
                    description: "Glass panes trap humid heat where ferns unfurl beside prized orchids. The air is thick with green growth and subtle animal warmth from aged wood and vintage perfumes. Outside it may be winter, but here spring is eternal."
                };
            }
            
            // Sacred/Warm combinations
            if (has('incense', 'frankincense') && hasFloral) {
                return {
                    title: "Temple at Prayer Time",
                    description: "Sacred smoke spirals toward painted ceilings as devotional flowers wilt on ancient altars. The air vibrates with whispered mantras and centuries of faith. Every breath feels like both question and answer, earth reaching toward heaven."
                };
            }
            
            if (has('tobacco', 'honey') && hasWoody) {
                return {
                    title: "Gentleman's Study",
                    description: "Leather chairs cradle worn cushions in a room lined with oak shelves. Pipe smoke curls lazily through honey-colored lamplight as rain patters on windows. This is a sanctuary of thought, comfort, and quiet contemplation."
                };
            }
            
            if (hasWarm && hasMusk && comp.base.length >= 2) {
                return {
                    title: "Ancient Spice Route",
                    description: "Caravan trails wind through amber dunes where merchants traded frankincense and mystery. The air shimmers with heat and precious aromatics wrapped in silk and secrets. You can almost hear the bells of approaching camels laden with treasures."
                };
            }
            
            // Floral combinations
            if (has('jasmine', 'saffron') && hasMusk) {
                return {
                    title: "Persian Palace Garden",
                    description: "Night falls on a marble courtyard where jasmine vines climb ancient walls. Saffron-stained carpets flutter in archways as servants light oil lamps. The air is thick with luxury, sensuality, and the weight of empires."
                };
            }
            
            if (has('lavender') && hasWoody && hasCitrus) {
                return {
                    title: "Provence Farmhouse",
                    description: "Purple fields stretch toward cedar-shuttered windows where lemon cakes cool on stone sills. Cicadas drone in the afternoon heat as lavender waves in the mistral wind. This is summer distilled to its essence‚Äîwarm, languid, perfect."
                };
            }
            
            if (has('lotus') && hasGreen && hasSynthetic) {
                return {
                    title: "Zen Water Garden",
                    description: "Lotus flowers float on mirror-still ponds reflecting minimal architecture. The scent is clean, green, almost transparent‚Äîmore concept than perfume. Here, you learn that emptiness itself can be beautiful, that less speaks volumes."
                };
            }
            
            // Woody combinations
            if (has('oud', 'saffron') && hasMusk) {
                return {
                    title: "Sultan's Private Chamber",
                    description: "Oud smoke curls through silk curtains in rooms where sunlight filters through pierced brass. Saffron threads stain porcelain bowls as amber beads warm against skin. Opulence and restraint meet in a dance of shadow and gold."
                };
            }
            
            if (has('cedar', 'vetiver') && hasGreen) {
                return {
                    title: "Forest After Rain",
                    description: "Water drips from pine needles onto earth dark with ancient leaf mold. Cedar bark releases its oils in the damp air as ferns unfurl new fronds. You're surrounded by growth, decay, and rebirth in perfect balance."
                };
            }
            
            if (has('sandalwood') && hasFloral && comp.base.includes('sandalwood')) {
                return {
                    title: "Indian Wedding Ceremony",
                    description: "Sandalwood paste marks blessed foreheads as flower garlands pile shoulder-high. Incense spirals through silk saris while drums pulse ancient rhythms. Joy and solemnity intertwine like the couple's joined hands, bound with sacred thread."
                };
            }
            
            // Musk dominant
            if (hasMusk && hasSynthetic && !hasFloral) {
                return {
                    title: "Modernist Penthouse",
                    description: "Floor-to-ceiling windows frame the city below as minimalist furniture casts geometric shadows. The air is clean, sophisticated, almost invisible‚Äîdesigned skin-musk amplified by technology. Everything here speaks of now, of progress, of the future arriving."
                };
            }
            
            if (has('amber', 'ambergris') && hasWoody) {
                return {
                    title: "Antiquarian's Study",
                    description: "Amber beads rest on velvet beside fossils pressed in ancient stone. The room smells of time itself‚Äîresinous, salty, woody, alive with the ghosts of extinct species. History isn't dead here; it breathes."
                };
            }
            
            // Complex multi-family combinations
            if (hasCitrus && hasFloral && hasWoody && hasMusk) {
                return {
                    title: "Grand Hotel Lobby, 1920s",
                    description: "Art deco columns frame arrangements of lilies and citrus as guests in evening wear cross marble floors. The air is a calculated masterpiece‚Äîfresh yet opulent, natural yet refined. This is the scent of an era when glamour was an art form."
                };
            }
            
            if (hasFruit && hasFloral && hasGreen && hasWarm) {
                return {
                    title: "Countryside Wedding",
                    description: "Wildflowers crown tables laden with pies still warm from the oven. Herb bundles hang drying as honey mead fills mason jars. Everything speaks of handmade joy, of community gathered to celebrate love rooted in the earth."
                };
            }
            
            if (hasSynthetic && hasWoody && hasCitrus) {
                return {
                    title: "Contemporary Art Museum",
                    description: "Concrete and cedar frame installations bathed in calculated light. The air is intentionally composed‚Äîozonic freshness cutting through warm wood, citrus brightening white walls. Even the scent here is curated, conceptual, a medium in itself."
                };
            }
            
            // Family-based fallbacks
            if (hasFloral && allNotes.length >= 4) {
                return {
                    title: "Florist's Workshop",
                    description: "Buckets overflow with blooms from morning market runs as water drips on wooden floors. Stems pile high on work tables where arrangements take shape for weddings, funerals, apologies, declarations. Flowers speak every language; you're learning their grammar."
                };
            }
            
            if (hasWoody && allNotes.length >= 3) {
                return {
                    title: "Carpenter's Studio",
                    description: "Sawdust catches afternoon light streaming through workshop windows. Different woods release distinct perfumes as planes shave curls from aged timber. The scent is honest, elemental‚Äîtrees transformed by craft into art."
                };
            }
            
            if (hasCitrus && allNotes.length >= 3) {
                return {
                    title: "Citrus Market, Sicily",
                    description: "Vendors slice fruit for tasting as juice runs sticky-sweet down their forearms. The whole square vibrates with color and commerce, crates stacked high as church bells mark the hour. This is abundance, sun-soaked and sharp."
                };
            }
            
            if (hasFruit && allNotes.length >= 2) {
                return {
                    title: "Orchard at Harvest",
                    description: "Ladders lean against branches bowing under ripe weight. Fruit bruises where it falls, fermenting sweetly in the grass. The air is thick with the season's generosity, with work done and winter stores secured."
                };
            }
            
            if (hasGreen) {
                return {
                    title: "Botanical Research Station",
                    description: "Specimens press between pages as field notes document rare plants. The air tastes green‚Äîchlorophyll and cellulose, photosynthesis in progress. Science and nature collaborate here in quiet, methodical wonder."
                };
            }
            
            if (hasMusk) {
                return {
                    title: "Vintage Perfumer's Lab",
                    description: "Glass bottles line shelves labeled in faded ink, their contents amber and mysterious. Musk tinctures age in oak, growing richer with time. This room knows secrets‚Äîformulas lost, scents extinct, beauty preserved."
                };
            }
            
            if (hasWarm) {
                return {
                    title: "Winter Hearthside",
                    description: "Flames dance behind grated iron as shadows stretch across stone floors. The air grows thick with smoke and sweetness, with warmth that seeps into bones. Outside, snow falls; inside, time suspends."
                };
            }
            
            if (hasSynthetic) {
                return {
                    title: "Laboratory of the Future",
                    description: "Sterile surfaces reflect fluorescent precision where molecules are designed, not discovered. The air is deliberately composed‚Äîtechnological, intentional, engineered. Nature isn't mimicked here; it's reimagined."
                };
            }
            
            // Ultimate fallback
            const noteList = allNotes.slice(0, 5).join(', ');
            const extras = allNotes.length > 5 ? ` and ${allNotes.length - 5} more` : '';
            
            return {
                title: "Your Personal Composition",
                description: `This unique blend of ${noteList}${extras} creates a scent landscape entirely your own. Like a half-remembered dream or a place that exists only in imagination, it defies simple description‚Äîa private world built from nature's most precious essences, arranged by your intuition alone.`
            };
        }

        function toggleSidebar() {
            document.getElementById('sidebar').classList.toggle('collapsed');
        }

        function toggleFamily(header) {
            header.parentElement.classList.toggle('open');
        }
    </script>
</body>
</html>